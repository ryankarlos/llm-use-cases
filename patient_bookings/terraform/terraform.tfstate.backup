{
  "version": 4,
  "terraform_version": "1.14.3",
  "serial": 107,
  "lineage": "58345e2a-0585-9ed9-51bf-676e11e8b95f",
  "outputs": {
    "agent_alias_id": {
      "value": "QGFY7425NI",
      "type": "string"
    },
    "agent_id": {
      "value": "P7QFL8LKUN",
      "type": "string"
    },
    "booking_flow_arn": {
      "value": "arn:aws:bedrock:us-east-1:376337229415:flow/6MJTEBZ19S",
      "type": "string"
    },
    "booking_flow_id": {
      "value": "6MJTEBZ19S",
      "type": "string"
    },
    "data_source_id": {
      "value": "5MD90JCUDG",
      "type": "string"
    },
    "demo_bucket": {
      "value": "nhs-booking-demo-demo-376337229415",
      "type": "string"
    },
    "env_vars": {
      "value": "export AWS_REGION=us-east-1\r\nexport BEDROCK_AGENT_ID=P7QFL8LKUN\r\nexport BEDROCK_AGENT_ALIAS_ID=QGFY7425NI\r\nexport AUDIO_BUCKET=nhs-booking-demo-demo-376337229415\r\n",
      "type": "string"
    },
    "kb_id": {
      "value": "BNGLROUXOJ",
      "type": "string"
    },
    "kb_source_bucket": {
      "value": "nhs-booking-demo-kb-source-376337229415",
      "type": "string"
    },
    "lambda_function": {
      "value": "nhs-booking-demo-actions",
      "type": "string"
    },
    "s3_vectors_bucket": {
      "value": "nhs-booking-demo-vectors",
      "type": "string"
    },
    "s3_vectors_index": {
      "value": "arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors/index/nhs-booking-demo-index",
      "type": "string"
    },
    "supervisor_agent_id": {
      "value": "R5CKKTHOFB",
      "type": "string"
    },
    "supervisor_alias_id": {
      "value": "CWU2HM8ITH",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "archive_file",
      "name": "lambda",
      "provider": "provider[\"registry.terraform.io/hashicorp/archive\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "exclude_symlink_directories": null,
            "excludes": null,
            "id": "a9877fb1657ad785a051f2775777d90a8e6a87d1",
            "output_base64sha256": "Srzbzd2QwXKe/+bc88wjf5X/Mf0+/m8VcRqb2H5XJT8=",
            "output_base64sha512": "CZCNxNYy0tNhatmGD92zfJSrr5Tpk1bWeQmExYCqPFFroXrlbcmSeci3qgq4SnnldDbKPWEAh9hj2qd8QikxWQ==",
            "output_file_mode": null,
            "output_md5": "56be088be08b2286b99cc298f0caf2b3",
            "output_path": "./.terraform/lambda.zip",
            "output_sha": "a9877fb1657ad785a051f2775777d90a8e6a87d1",
            "output_sha256": "4abcdbcddd90c1729effe6dcf3cc237f95ff31fd3efe6f15711a9bd87e57253f",
            "output_sha512": "09908dc4d632d2d3616ad9860fddb37c94abaf94e99356d6790984c580aa3c516ba17ae56dc99279c8b7aa0ab84a79e57436ca3d610087d863daa77c42293159",
            "output_size": 10912,
            "source": [
              {
                "content": "\"\"\"Lambda handler for Bedrock Agent action groups.\r\n\r\nHandles booking, approval, and notification actions.\r\n\"\"\"\r\n\r\nimport json\r\nimport os\r\nimport uuid\r\nfrom datetime import datetime, timedelta\r\nfrom urllib.parse import quote_plus\r\n\r\nimport boto3\r\n\r\n# Initialize clients\r\ndynamodb = boto3.resource(\"dynamodb\")\r\nses = boto3.client(\"ses\")\r\nsns = boto3.client(\"sns\")\r\nlocation = boto3.client(\"geo-places\")\r\n\r\n# Optional: For web search fallback\r\ntry:\r\n    import requests\r\n    HAS_REQUESTS = True\r\nexcept ImportError:\r\n    HAS_REQUESTS = False\r\n\r\nBOOKINGS_TABLE = os.environ.get(\"BOOKINGS_TABLE\", \"nhs-booking-demo-bookings\")\r\nSESSIONS_TABLE = os.environ.get(\"SESSIONS_TABLE\", \"nhs-booking-demo-sessions\")\r\nPRESCRIPTIONS_TABLE = os.environ.get(\"PRESCRIPTIONS_TABLE\", \"nhs-booking-demo-prescriptions\")\r\nREFERRALS_TABLE = os.environ.get(\"REFERRALS_TABLE\", \"nhs-booking-demo-referrals\")\r\n\r\n\r\ndef handler(event, context):\r\n    \"\"\"Main Lambda handler for Bedrock Agent actions.\"\"\"\r\n    \r\n    print(f\"Event: {json.dumps(event)}\")\r\n    \r\n    # Extract action details\r\n    action_group = event.get(\"actionGroup\", \"\")\r\n    api_path = event.get(\"apiPath\", \"\")\r\n    parameters = event.get(\"requestBody\", {}).get(\"content\", {}).get(\"application/json\", {}).get(\"properties\", [])\r\n    \r\n    # Convert parameters list to dict\r\n    params = {p[\"name\"]: p[\"value\"] for p in parameters}\r\n    \r\n    # Route to appropriate handler\r\n    handlers = {\r\n        # Booking actions\r\n        \"/check-availability\": check_availability,\r\n        \"/create-booking\": create_booking,\r\n        # Approval actions\r\n        \"/validate-booking\": validate_booking,\r\n        \"/approve-booking\": approve_booking,\r\n        # Notification actions\r\n        \"/send-confirmation\": send_confirmation,\r\n        \"/send-letter\": send_letter,\r\n        # Location actions\r\n        \"/find-nearby-hospitals\": find_nearby_hospitals,\r\n        \"/find-nearby-pharmacies\": find_nearby_pharmacies,\r\n        # Referral actions\r\n        \"/validate-referral\": validate_referral,\r\n        \"/create-referral\": create_referral,\r\n        # Prescription actions\r\n        \"/request-prescription\": request_prescription,\r\n        \"/check-prescription-status\": check_prescription_status,\r\n        \"/request-pharmacy-delivery\": request_pharmacy_delivery,\r\n    }\r\n    \r\n    handler_func = handlers.get(api_path)\r\n    if handler_func:\r\n        result = handler_func(params)\r\n    else:\r\n        result = {\"error\": f\"Unknown action: {api_path}\"}\r\n    \r\n    # Format response for Bedrock Agent\r\n    return {\r\n        \"messageVersion\": \"1.0\",\r\n        \"response\": {\r\n            \"actionGroup\": action_group,\r\n            \"apiPath\": api_path,\r\n            \"httpMethod\": \"POST\",\r\n            \"httpStatusCode\": 200,\r\n            \"responseBody\": {\r\n                \"application/json\": {\r\n                    \"body\": json.dumps(result)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n# ============ Booking Actions ============\r\n\r\ndef check_availability(params):\r\n    \"\"\"Check available appointment slots.\"\"\"\r\n    \r\n    appointment_type = params.get(\"appointment_type\", \"gp\")\r\n    preferred_date = params.get(\"preferred_date\", \"\")\r\n    urgency = params.get(\"urgency\", \"routine\")\r\n    \r\n    # Generate mock availability (in production, query real system)\r\n    today = datetime.now()\r\n    slots = []\r\n    \r\n    if urgency == \"urgent\":\r\n        # Same day or next day for urgent\r\n        for i in range(2):\r\n            date = today + timedelta(days=i)\r\n            slots.append({\r\n                \"date\": date.strftime(\"%Y-%m-%d\"),\r\n                \"time\": \"09:30\" if i == 0 else \"14:00\",\r\n                \"doctor\": \"Dr. Smith (Duty GP)\",\r\n                \"type\": \"urgent\"\r\n            })\r\n    else:\r\n        # 1-2 weeks out for routine\r\n        for i in range(7, 14, 2):\r\n            date = today + timedelta(days=i)\r\n            if date.weekday() \u003c 5:  # Weekdays\r\n                slots.append({\r\n                    \"date\": date.strftime(\"%Y-%m-%d\"),\r\n                    \"time\": \"10:00\",\r\n                    \"doctor\": \"Dr. Johnson\" if i % 4 == 0 else \"Dr. Williams\",\r\n                    \"type\": \"routine\"\r\n                })\r\n    \r\n    return {\r\n        \"available_slots\": slots[:3],\r\n        \"appointment_type\": appointment_type,\r\n        \"message\": f\"Found {len(slots[:3])} available slots for {appointment_type} appointment\"\r\n    }\r\n\r\n\r\ndef create_booking(params):\r\n    \"\"\"Create a new booking.\"\"\"\r\n    \r\n    booking_id = f\"NHS-{datetime.now().strftime('%Y%m%d')}-{uuid.uuid4().hex[:6].upper()}\"\r\n    \r\n    booking = {\r\n        \"booking_id\": booking_id,\r\n        \"patient_name\": params.get(\"patient_name\", \"Unknown\"),\r\n        \"appointment_type\": params.get(\"appointment_type\", \"gp\"),\r\n        \"date\": params.get(\"date\", \"\"),\r\n        \"time\": params.get(\"time\", \"\"),\r\n        \"reason\": params.get(\"reason\", \"\"),\r\n        \"status\": \"pending\",\r\n        \"created_at\": datetime.now().isoformat()\r\n    }\r\n    \r\n    # Save to DynamoDB\r\n    try:\r\n        table = dynamodb.Table(BOOKINGS_TABLE)\r\n        table.put_item(Item=booking)\r\n    except Exception as e:\r\n        print(f\"DynamoDB error: {e}\")\r\n    \r\n    return {\r\n        \"booking_id\": booking_id,\r\n        \"status\": \"pending\",\r\n        \"message\": f\"Booking {booking_id} created. Awaiting approval.\"\r\n    }\r\n\r\n\r\n# ============ Approval Actions ============\r\n\r\ndef validate_booking(params):\r\n    \"\"\"Validate a booking request.\"\"\"\r\n    \r\n    booking_id = params.get(\"booking_id\", \"\")\r\n    \r\n    # Get booking from DynamoDB\r\n    try:\r\n        table = dynamodb.Table(BOOKINGS_TABLE)\r\n        response = table.get_item(Key={\"booking_id\": booking_id})\r\n        booking = response.get(\"Item\", {})\r\n    except Exception:\r\n        booking = {}\r\n    \r\n    if not booking:\r\n        return {\"valid\": False, \"reason\": \"Booking not found\"}\r\n    \r\n    # Simple validation rules\r\n    issues = []\r\n    \r\n    if not booking.get(\"patient_name\"):\r\n        issues.append(\"Patient name required\")\r\n    if not booking.get(\"date\"):\r\n        issues.append(\"Appointment date required\")\r\n    if not booking.get(\"time\"):\r\n        issues.append(\"Appointment time required\")\r\n    \r\n    if issues:\r\n        return {\r\n            \"valid\": False,\r\n            \"booking_id\": booking_id,\r\n            \"issues\": issues\r\n        }\r\n    \r\n    return {\r\n        \"valid\": True,\r\n        \"booking_id\": booking_id,\r\n        \"message\": \"Booking validated successfully\"\r\n    }\r\n\r\n\r\ndef approve_booking(params):\r\n    \"\"\"Approve a validated booking.\"\"\"\r\n    \r\n    booking_id = params.get(\"booking_id\", \"\")\r\n    \r\n    # Update booking status\r\n    try:\r\n        table = dynamodb.Table(BOOKINGS_TABLE)\r\n        table.update_item(\r\n            Key={\"booking_id\": booking_id},\r\n            UpdateExpression=\"SET #status = :status, approved_at = :time\",\r\n            ExpressionAttributeNames={\"#status\": \"status\"},\r\n            ExpressionAttributeValues={\r\n                \":status\": \"approved\",\r\n                \":time\": datetime.now().isoformat()\r\n            }\r\n        )\r\n        \r\n        # Get updated booking\r\n        response = table.get_item(Key={\"booking_id\": booking_id})\r\n        booking = response.get(\"Item\", {})\r\n        \r\n    except Exception as e:\r\n        print(f\"Approval error: {e}\")\r\n        return {\"approved\": False, \"error\": str(e)}\r\n    \r\n    return {\r\n        \"approved\": True,\r\n        \"booking_id\": booking_id,\r\n        \"date\": booking.get(\"date\", \"\"),\r\n        \"time\": booking.get(\"time\", \"\"),\r\n        \"message\": f\"Booking {booking_id} has been approved and confirmed.\"\r\n    }\r\n\r\n\r\n# ============ Notification Actions ============\r\n\r\ndef send_confirmation(params):\r\n    \"\"\"Send booking confirmation via email and SMS.\"\"\"\r\n    \r\n    booking_id = params.get(\"booking_id\", \"\")\r\n    email = params.get(\"email\", \"\")\r\n    phone = params.get(\"phone\", \"\")\r\n    \r\n    # Get booking details\r\n    try:\r\n        table = dynamodb.Table(BOOKINGS_TABLE)\r\n        response = table.get_item(Key={\"booking_id\": booking_id})\r\n        booking = response.get(\"Item\", {})\r\n    except Exception:\r\n        booking = {}\r\n    \r\n    if not booking:\r\n        return {\"sent\": False, \"error\": \"Booking not found\"}\r\n    \r\n    # Format confirmation message\r\n    message = f\"\"\"\r\nNHS Appointment Confirmation\r\n\r\nReference: {booking_id}\r\nDate: {booking.get('date', 'TBC')}\r\nTime: {booking.get('time', 'TBC')}\r\nType: {booking.get('appointment_type', 'GP').upper()} Appointment\r\n\r\nPlease arrive 10 minutes early.\r\nTo cancel, call the surgery or reply to this message.\r\n    \"\"\".strip()\r\n    \r\n    sent_to = []\r\n    \r\n    # Send email (demo - would use SES in production)\r\n    if email:\r\n        print(f\"[DEMO] Would send email to {email}\")\r\n        sent_to.append(f\"email:{email}\")\r\n    \r\n    # Send SMS (demo - would use SNS in production)\r\n    if phone:\r\n        print(f\"[DEMO] Would send SMS to {phone}\")\r\n        sent_to.append(f\"sms:{phone}\")\r\n    \r\n    return {\r\n        \"sent\": True,\r\n        \"booking_id\": booking_id,\r\n        \"sent_to\": sent_to,\r\n        \"message\": \"Confirmation sent successfully\"\r\n    }\r\n\r\n\r\ndef send_letter(params):\r\n    \"\"\"Send a letter via email.\"\"\"\r\n    \r\n    booking_id = params.get(\"booking_id\", \"\")\r\n    letter_type = params.get(\"letter_type\", \"confirmation\")\r\n    email = params.get(\"email\", \"\")\r\n    \r\n    # Get booking details\r\n    try:\r\n        table = dynamodb.Table(BOOKINGS_TABLE)\r\n        response = table.get_item(Key={\"booking_id\": booking_id})\r\n        booking = response.get(\"Item\", {})\r\n    except Exception:\r\n        booking = {}\r\n    \r\n    # Generate letter content based on type\r\n    letters = {\r\n        \"confirmation\": f\"\"\"\r\nDear {booking.get('patient_name', 'Patient')},\r\n\r\nThis letter confirms your appointment.\r\n\r\nReference: {booking_id}\r\nDate: {booking.get('date', 'TBC')}\r\nTime: {booking.get('time', 'TBC')}\r\n\r\nPlease bring any relevant documents or test results.\r\n\r\nYours sincerely,\r\nNHS Patient Booking System\r\n        \"\"\",\r\n        \"referral\": f\"\"\"\r\nDear Colleague,\r\n\r\nI am referring {booking.get('patient_name', 'this patient')} for specialist assessment.\r\n\r\nReason: {booking.get('reason', 'As discussed')}\r\n\r\nPlease arrange an appointment at your earliest convenience.\r\n\r\nYours sincerely,\r\nGP Surgery\r\n        \"\"\",\r\n        \"follow-up\": f\"\"\"\r\nDear {booking.get('patient_name', 'Patient')},\r\n\r\nFollowing your recent appointment, please note the following:\r\n\r\n{booking.get('reason', 'Please contact the surgery if you have any questions.')}\r\n\r\nYours sincerely,\r\nNHS Patient Booking System\r\n        \"\"\"\r\n    }\r\n    \r\n    letter_content = letters.get(letter_type, letters[\"confirmation\"])\r\n    \r\n    print(f\"[DEMO] Would send {letter_type} letter to {email}\")\r\n    \r\n    return {\r\n        \"sent\": True,\r\n        \"booking_id\": booking_id,\r\n        \"letter_type\": letter_type,\r\n        \"message\": f\"{letter_type.title()} letter sent to {email}\"\r\n    }\r\n\r\n\r\n# ============ Location Actions ============\r\n\r\ndef find_nearby_hospitals(params):\r\n    \"\"\"Find nearby hospitals using Amazon Location Service with web search fallback.\r\n    \r\n    Requires patient address to geocode and find nearby NHS facilities.\r\n    Returns hospital name, full address, distance, phone, and services.\r\n    \"\"\"\r\n    \r\n    patient_name = params.get(\"patient_name\", \"\")\r\n    patient_address = params.get(\"patient_address\", \"\")\r\n    max_results = int(params.get(\"max_results\", 5))\r\n    \r\n    if not patient_address:\r\n        return {\r\n            \"success\": False,\r\n            \"error\": \"Patient address is required to find nearby hospitals\",\r\n            \"required_info\": [\"patient_name\", \"patient_address\"]\r\n        }\r\n    \r\n    try:\r\n        # First, geocode the patient's address to get coordinates\r\n        geocode_response = location.geocode(\r\n            QueryText=patient_address,\r\n            MaxResults=1,\r\n            Filter={\r\n                \"IncludeCountries\": [\"GBR\"]  # UK only\r\n            }\r\n        )\r\n        \r\n        if not geocode_response.get(\"ResultItems\"):\r\n            return {\r\n                \"success\": False,\r\n                \"error\": f\"Could not find location for address: {patient_address}\",\r\n                \"suggestion\": \"Please provide a more specific UK address including postcode\"\r\n            }\r\n        \r\n        # Get coordinates from geocode result\r\n        position = geocode_response[\"ResultItems\"][0][\"Position\"]\r\n        longitude, latitude = position[0], position[1]\r\n        \r\n        # Search for nearby hospitals\r\n        search_response = location.search_nearby(\r\n            QueryPosition=[longitude, latitude],\r\n            MaxResults=max_results,\r\n            Filter={\r\n                \"IncludeCategories\": [\"hospital\", \"medical-center\", \"health-care\"]\r\n            }\r\n        )\r\n        \r\n        hospitals = []\r\n        for item in search_response.get(\"ResultItems\", []):\r\n            # Extract full address from response\r\n            addr = item.get(\"Address\", {})\r\n            full_address = addr.get(\"Label\", \"\")\r\n            if not full_address:\r\n                # Build address from components\r\n                parts = []\r\n                if addr.get(\"AddressNumber\"):\r\n                    parts.append(addr.get(\"AddressNumber\"))\r\n                if addr.get(\"Street\"):\r\n                    parts.append(addr.get(\"Street\"))\r\n                if addr.get(\"Locality\"):\r\n                    parts.append(addr.get(\"Locality\"))\r\n                if addr.get(\"PostalCode\"):\r\n                    parts.append(addr.get(\"PostalCode\"))\r\n                full_address = \", \".join(parts) if parts else \"Address not available\"\r\n            \r\n            # Extract phone number\r\n            contacts = item.get(\"Contacts\", {})\r\n            phones = contacts.get(\"Phones\", [])\r\n            phone = phones[0].get(\"Value\", \"\") if phones else \"\"\r\n            \r\n            hospital = {\r\n                \"name\": item.get(\"Title\", \"Unknown Hospital\"),\r\n                \"address\": full_address,\r\n                \"postcode\": addr.get(\"PostalCode\", \"\"),\r\n                \"distance_km\": round(item.get(\"Distance\", 0) / 1000, 1),\r\n                \"phone\": phone,\r\n                \"services\": _get_hospital_services(item.get(\"Categories\", [])),\r\n                \"nhs_trust\": _extract_nhs_trust(item.get(\"Title\", \"\"))\r\n            }\r\n            hospitals.append(hospital)\r\n        \r\n        if not hospitals:\r\n            # Fallback to curated NHS hospital data\r\n            return _get_nhs_hospitals_for_area(patient_name, patient_address)\r\n        \r\n        return {\r\n            \"success\": True,\r\n            \"patient_name\": patient_name,\r\n            \"search_location\": patient_address,\r\n            \"coordinates\": {\"latitude\": latitude, \"longitude\": longitude},\r\n            \"nearby_hospitals\": hospitals,\r\n            \"message\": f\"Found {len(hospitals)} NHS facilities near {patient_address}\",\r\n            \"source\": \"Amazon Location Service\"\r\n        }\r\n        \r\n    except Exception as e:\r\n        # Fallback to curated NHS data\r\n        print(f\"Location Service error: {e}\")\r\n        return _get_nhs_hospitals_for_area(patient_name, patient_address)\r\n\r\n\r\ndef _get_hospital_services(categories):\r\n    \"\"\"Map location categories to NHS services.\"\"\"\r\n    service_map = {\r\n        \"hospital\": \"General Hospital\",\r\n        \"medical-center\": \"Medical Centre\",\r\n        \"health-care\": \"Healthcare\",\r\n        \"emergency\": \"A\u0026E\",\r\n        \"clinic\": \"Clinic\"\r\n    }\r\n    services = []\r\n    for cat in categories:\r\n        cat_id = cat.get(\"Id\", \"\").lower() if isinstance(cat, dict) else str(cat).lower()\r\n        if cat_id in service_map:\r\n            services.append(service_map[cat_id])\r\n    return services if services else [\"General Healthcare\"]\r\n\r\n\r\ndef _extract_nhs_trust(name):\r\n    \"\"\"Extract NHS Trust name from hospital name.\"\"\"\r\n    trust_keywords = [\"NHS\", \"Trust\", \"Foundation\"]\r\n    if any(kw in name for kw in trust_keywords):\r\n        return name\r\n    return \"NHS\"\r\n\r\n\r\ndef _get_nhs_hospitals_for_area(patient_name, patient_address):\r\n    \"\"\"Return curated NHS hospital data based on area.\r\n    \r\n    Uses postcode prefix to return relevant hospitals.\r\n    \"\"\"\r\n    # Extract postcode area from address\r\n    postcode_area = _extract_postcode_area(patient_address)\r\n    \r\n    # Curated NHS hospital data by London area\r\n    nhs_hospitals_by_area = {\r\n        \"SE\": [  # South East London\r\n            {\r\n                \"name\": \"St Thomas' Hospital\",\r\n                \"address\": \"Westminster Bridge Road, Lambeth, London SE1 7EH\",\r\n                \"postcode\": \"SE1 7EH\",\r\n                \"distance_km\": 1.2,\r\n                \"phone\": \"020 7188 7188\",\r\n                \"nhs_trust\": \"Guy's and St Thomas' NHS Foundation Trust\",\r\n                \"services\": [\"A\u0026E\", \"Maternity\", \"Cancer Care\", \"Cardiology\"]\r\n            },\r\n            {\r\n                \"name\": \"Guy's Hospital\",\r\n                \"address\": \"Great Maze Pond, Southwark, London SE1 9RT\",\r\n                \"postcode\": \"SE1 9RT\",\r\n                \"distance_km\": 1.8,\r\n                \"phone\": \"020 7188 7188\",\r\n                \"nhs_trust\": \"Guy's and St Thomas' NHS Foundation Trust\",\r\n                \"services\": [\"Specialist Care\", \"Dental Hospital\", \"Outpatient\"]\r\n            },\r\n            {\r\n                \"name\": \"King's College Hospital\",\r\n                \"address\": \"Denmark Hill, Camberwell, London SE5 9RS\",\r\n                \"postcode\": \"SE5 9RS\",\r\n                \"distance_km\": 3.5,\r\n                \"phone\": \"020 3299 9000\",\r\n                \"nhs_trust\": \"King's College Hospital NHS Foundation Trust\",\r\n                \"services\": [\"A\u0026E\", \"Major Trauma Centre\", \"Liver Unit\"]\r\n            },\r\n            {\r\n                \"name\": \"Lewisham Hospital\",\r\n                \"address\": \"High Street, Lewisham, London SE13 6LH\",\r\n                \"postcode\": \"SE13 6LH\",\r\n                \"distance_km\": 5.2,\r\n                \"phone\": \"020 8333 3000\",\r\n                \"nhs_trust\": \"Lewisham and Greenwich NHS Trust\",\r\n                \"services\": [\"A\u0026E\", \"Maternity\", \"Paediatrics\"]\r\n            },\r\n            {\r\n                \"name\": \"Queen Elizabeth Hospital\",\r\n                \"address\": \"Stadium Road, Woolwich, London SE18 4QH\",\r\n                \"postcode\": \"SE18 4QH\",\r\n                \"distance_km\": 8.1,\r\n                \"phone\": \"020 8836 6000\",\r\n                \"nhs_trust\": \"Lewisham and Greenwich NHS Trust\",\r\n                \"services\": [\"A\u0026E\", \"Surgery\", \"Diagnostics\"]\r\n            }\r\n        ],\r\n        \"SW\": [  # South West London\r\n            {\r\n                \"name\": \"St George's Hospital\",\r\n                \"address\": \"Blackshaw Road, Tooting, London SW17 0QT\",\r\n                \"postcode\": \"SW17 0QT\",\r\n                \"distance_km\": 2.5,\r\n                \"phone\": \"020 8672 1255\",\r\n                \"nhs_trust\": \"St George's University Hospitals NHS Foundation Trust\",\r\n                \"services\": [\"A\u0026E\", \"Major Trauma Centre\", \"Neurosciences\"]\r\n            },\r\n            {\r\n                \"name\": \"Chelsea and Westminster Hospital\",\r\n                \"address\": \"369 Fulham Road, Chelsea, London SW10 9NH\",\r\n                \"postcode\": \"SW10 9NH\",\r\n                \"distance_km\": 3.8,\r\n                \"phone\": \"020 3315 8000\",\r\n                \"nhs_trust\": \"Chelsea and Westminster Hospital NHS Foundation Trust\",\r\n                \"services\": [\"A\u0026E\", \"HIV/Sexual Health\", \"Burns Unit\"]\r\n            },\r\n            {\r\n                \"name\": \"Kingston Hospital\",\r\n                \"address\": \"Galsworthy Road, Kingston upon Thames KT2 7QB\",\r\n                \"postcode\": \"KT2 7QB\",\r\n                \"distance_km\": 6.2,\r\n                \"phone\": \"020 8546 7711\",\r\n                \"nhs_trust\": \"Kingston Hospital NHS Foundation Trust\",\r\n                \"services\": [\"A\u0026E\", \"Maternity\", \"Stroke Unit\"]\r\n            }\r\n        ],\r\n        \"W\": [  # West London\r\n            {\r\n                \"name\": \"Charing Cross Hospital\",\r\n                \"address\": \"Fulham Palace Road, Hammersmith, London W6 8RF\",\r\n                \"postcode\": \"W6 8RF\",\r\n                \"distance_km\": 2.0,\r\n                \"phone\": \"020 3311 1234\",\r\n                \"nhs_trust\": \"Imperial College Healthcare NHS Trust\",\r\n                \"services\": [\"A\u0026E\", \"Stroke Unit\", \"Rehabilitation\"]\r\n            },\r\n            {\r\n                \"name\": \"Hammersmith Hospital\",\r\n                \"address\": \"Du Cane Road, East Acton, London W12 0HS\",\r\n                \"postcode\": \"W12 0HS\",\r\n                \"distance_km\": 3.5,\r\n                \"phone\": \"020 3313 1000\",\r\n                \"nhs_trust\": \"Imperial College Healthcare NHS Trust\",\r\n                \"services\": [\"Specialist Care\", \"Renal Unit\", \"Haematology\"]\r\n            },\r\n            {\r\n                \"name\": \"St Mary's Hospital\",\r\n                \"address\": \"Praed Street, Paddington, London W2 1NY\",\r\n                \"postcode\": \"W2 1NY\",\r\n                \"distance_km\": 4.2,\r\n                \"phone\": \"020 3312 6666\",\r\n                \"nhs_trust\": \"Imperial College Healthcare NHS Trust\",\r\n                \"services\": [\"A\u0026E\", \"Major Trauma Centre\", \"Maternity\"]\r\n            }\r\n        ],\r\n        \"N\": [  # North London\r\n            {\r\n                \"name\": \"Royal Free Hospital\",\r\n                \"address\": \"Pond Street, Hampstead, London NW3 2QG\",\r\n                \"postcode\": \"NW3 2QG\",\r\n                \"distance_km\": 2.8,\r\n                \"phone\": \"020 7794 0500\",\r\n                \"nhs_trust\": \"Royal Free London NHS Foundation Trust\",\r\n                \"services\": [\"A\u0026E\", \"Liver Transplant\", \"Renal\"]\r\n            },\r\n            {\r\n                \"name\": \"University College Hospital\",\r\n                \"address\": \"235 Euston Road, Bloomsbury, London NW1 2BU\",\r\n                \"postcode\": \"NW1 2BU\",\r\n                \"distance_km\": 3.5,\r\n                \"phone\": \"020 3456 7890\",\r\n                \"nhs_trust\": \"University College London Hospitals NHS Foundation Trust\",\r\n                \"services\": [\"A\u0026E\", \"Cancer Centre\", \"Neurology\"]\r\n            },\r\n            {\r\n                \"name\": \"Whittington Hospital\",\r\n                \"address\": \"Magdala Avenue, Archway, London N19 5NF\",\r\n                \"postcode\": \"N19 5NF\",\r\n                \"distance_km\": 4.1,\r\n                \"phone\": \"020 7272 3070\",\r\n                \"nhs_trust\": \"Whittington Health NHS Trust\",\r\n                \"services\": [\"A\u0026E\", \"Maternity\", \"Sexual Health\"]\r\n            }\r\n        ],\r\n        \"E\": [  # East London\r\n            {\r\n                \"name\": \"The Royal London Hospital\",\r\n                \"address\": \"Whitechapel Road, Whitechapel, London E1 1FR\",\r\n                \"postcode\": \"E1 1FR\",\r\n                \"distance_km\": 2.0,\r\n                \"phone\": \"020 7377 7000\",\r\n                \"nhs_trust\": \"Barts Health NHS Trust\",\r\n                \"services\": [\"A\u0026E\", \"Major Trauma Centre\", \"Children's Hospital\"]\r\n            },\r\n            {\r\n                \"name\": \"Homerton University Hospital\",\r\n                \"address\": \"Homerton Row, Hackney, London E9 6SR\",\r\n                \"postcode\": \"E9 6SR\",\r\n                \"distance_km\": 3.8,\r\n                \"phone\": \"020 8510 5555\",\r\n                \"nhs_trust\": \"Homerton Healthcare NHS Foundation Trust\",\r\n                \"services\": [\"A\u0026E\", \"Maternity\", \"Stroke Unit\"]\r\n            },\r\n            {\r\n                \"name\": \"Newham University Hospital\",\r\n                \"address\": \"Glen Road, Plaistow, London E13 8SL\",\r\n                \"postcode\": \"E13 8SL\",\r\n                \"distance_km\": 5.5,\r\n                \"phone\": \"020 7476 4000\",\r\n                \"nhs_trust\": \"Barts Health NHS Trust\",\r\n                \"services\": [\"A\u0026E\", \"Maternity\", \"Diagnostics\"]\r\n            }\r\n        ],\r\n        \"DEFAULT\": [  # Default London hospitals\r\n            {\r\n                \"name\": \"St Thomas' Hospital\",\r\n                \"address\": \"Westminster Bridge Road, Lambeth, London SE1 7EH\",\r\n                \"postcode\": \"SE1 7EH\",\r\n                \"distance_km\": 2.0,\r\n                \"phone\": \"020 7188 7188\",\r\n                \"nhs_trust\": \"Guy's and St Thomas' NHS Foundation Trust\",\r\n                \"services\": [\"A\u0026E\", \"Maternity\", \"Cancer Care\"]\r\n            },\r\n            {\r\n                \"name\": \"University College Hospital\",\r\n                \"address\": \"235 Euston Road, Bloomsbury, London NW1 2BU\",\r\n                \"postcode\": \"NW1 2BU\",\r\n                \"distance_km\": 3.0,\r\n                \"phone\": \"020 3456 7890\",\r\n                \"nhs_trust\": \"University College London Hospitals NHS Foundation Trust\",\r\n                \"services\": [\"A\u0026E\", \"Cancer Centre\", \"Neurology\"]\r\n            },\r\n            {\r\n                \"name\": \"The Royal London Hospital\",\r\n                \"address\": \"Whitechapel Road, Whitechapel, London E1 1FR\",\r\n                \"postcode\": \"E1 1FR\",\r\n                \"distance_km\": 4.0,\r\n                \"phone\": \"020 7377 7000\",\r\n                \"nhs_trust\": \"Barts Health NHS Trust\",\r\n                \"services\": [\"A\u0026E\", \"Major Trauma Centre\", \"Children's Hospital\"]\r\n            }\r\n        ]\r\n    }\r\n    \r\n    # Get hospitals for the area\r\n    hospitals = nhs_hospitals_by_area.get(postcode_area, nhs_hospitals_by_area[\"DEFAULT\"])\r\n    \r\n    return {\r\n        \"success\": True,\r\n        \"patient_name\": patient_name,\r\n        \"search_location\": patient_address,\r\n        \"nearby_hospitals\": hospitals[:5],\r\n        \"message\": f\"Found {len(hospitals[:5])} NHS hospitals near {patient_address}\",\r\n        \"source\": \"NHS Hospital Directory\",\r\n        \"note\": \"Data from official NHS sources. For emergencies, call 999.\"\r\n    }\r\n\r\n\r\ndef _extract_postcode_area(address):\r\n    \"\"\"Extract postcode area prefix from address.\"\"\"\r\n    import re\r\n    # UK postcode pattern\r\n    postcode_pattern = r'\\b([A-Z]{1,2})\\d'\r\n    match = re.search(postcode_pattern, address.upper())\r\n    if match:\r\n        return match.group(1)\r\n    \r\n    # Check for area names\r\n    area_keywords = {\r\n        \"SE\": [\"southwark\", \"lewisham\", \"greenwich\", \"bermondsey\", \"peckham\", \"camberwell\"],\r\n        \"SW\": [\"chelsea\", \"fulham\", \"wandsworth\", \"battersea\", \"brixton\", \"clapham\", \"tooting\"],\r\n        \"W\": [\"hammersmith\", \"kensington\", \"notting hill\", \"paddington\", \"acton\", \"ealing\"],\r\n        \"N\": [\"islington\", \"camden\", \"hampstead\", \"highgate\", \"finsbury\", \"holloway\"],\r\n        \"E\": [\"whitechapel\", \"hackney\", \"stratford\", \"bow\", \"mile end\", \"bethnal green\"],\r\n        \"NW\": [\"kilburn\", \"willesden\", \"cricklewood\", \"hendon\"],\r\n        \"EC\": [\"city\", \"moorgate\", \"liverpool street\"],\r\n        \"WC\": [\"holborn\", \"covent garden\", \"bloomsbury\"]\r\n    }\r\n    \r\n    address_lower = address.lower()\r\n    for area, keywords in area_keywords.items():\r\n        if any(kw in address_lower for kw in keywords):\r\n            return area\r\n    \r\n    return \"DEFAULT\"\r\n\r\n\r\ndef _mock_nearby_hospitals(patient_name, patient_address):\r\n    \"\"\"Legacy function - redirects to new NHS hospital lookup.\"\"\"\r\n    return _get_nhs_hospitals_for_area(patient_name, patient_address)\r\n\r\n\r\n# ============ Referral Actions ============\r\n\r\ndef validate_referral(params):\r\n    \"\"\"Validate if patient has a GP referral for specialist/hospital booking.\r\n    \r\n    Hospital and specialist appointments typically require a GP referral.\r\n    This checks if a valid referral exists for the patient.\r\n    \"\"\"\r\n    \r\n    patient_name = params.get(\"patient_name\", \"\")\r\n    patient_nhs_number = params.get(\"nhs_number\", \"\")\r\n    specialty = params.get(\"specialty\", \"\")\r\n    \r\n    if not patient_name and not patient_nhs_number:\r\n        return {\r\n            \"valid\": False,\r\n            \"error\": \"Patient name or NHS number required\",\r\n            \"required_info\": [\"patient_name or nhs_number\", \"specialty\"]\r\n        }\r\n    \r\n    # Check for existing referral in DynamoDB\r\n    try:\r\n        table = dynamodb.Table(REFERRALS_TABLE)\r\n        \r\n        # In production, would query by NHS number or patient name\r\n        # For demo, we'll simulate referral lookup\r\n        if patient_nhs_number:\r\n            response = table.get_item(Key={\"referral_id\": f\"REF-{patient_nhs_number}\"})\r\n            referral = response.get(\"Item\")\r\n        else:\r\n            referral = None\r\n            \r\n    except Exception as e:\r\n        print(f\"Referral lookup error: {e}\")\r\n        referral = None\r\n    \r\n    # Simulate referral validation for demo\r\n    # In production, this would check the NHS Spine or local referral system\r\n    if referral and referral.get(\"status\") == \"active\":\r\n        return {\r\n            \"valid\": True,\r\n            \"referral_id\": referral.get(\"referral_id\"),\r\n            \"patient_name\": patient_name,\r\n            \"specialty\": referral.get(\"specialty\"),\r\n            \"referring_gp\": referral.get(\"referring_gp\"),\r\n            \"valid_until\": referral.get(\"valid_until\"),\r\n            \"message\": \"Valid GP referral found. You can proceed with specialist booking.\"\r\n        }\r\n    \r\n    # No referral found - provide guidance\r\n    return {\r\n        \"valid\": False,\r\n        \"patient_name\": patient_name,\r\n        \"specialty\": specialty,\r\n        \"reason\": \"No valid GP referral found for this specialty\",\r\n        \"guidance\": [\r\n            \"Most specialist and hospital appointments require a GP referral\",\r\n            \"Please book a GP appointment first to discuss your condition\",\r\n            \"Your GP can then refer you to the appropriate specialist\",\r\n            \"Some services accept self-referral (e.g., sexual health, A\u0026E)\"\r\n        ],\r\n        \"self_referral_services\": [\r\n            \"Accident \u0026 Emergency (A\u0026E)\",\r\n            \"Sexual health clinics\",\r\n            \"NHS talking therapies (IAPT)\",\r\n            \"Drug and alcohol services\"\r\n        ],\r\n        \"message\": \"GP referral required. Please see your GP first or check if self-referral is available.\"\r\n    }\r\n\r\n\r\ndef create_referral(params):\r\n    \"\"\"Create a GP referral for specialist appointment.\r\n    \r\n    This would typically be done by the GP, but included for demo completeness.\r\n    \"\"\"\r\n    \r\n    referral_id = f\"REF-{datetime.now().strftime('%Y%m%d')}-{uuid.uuid4().hex[:6].upper()}\"\r\n    \r\n    referral = {\r\n        \"referral_id\": referral_id,\r\n        \"patient_name\": params.get(\"patient_name\", \"\"),\r\n        \"nhs_number\": params.get(\"nhs_number\", \"\"),\r\n        \"specialty\": params.get(\"specialty\", \"\"),\r\n        \"referring_gp\": params.get(\"referring_gp\", \"Dr. Smith\"),\r\n        \"gp_surgery\": params.get(\"gp_surgery\", \"Main Street Surgery\"),\r\n        \"reason\": params.get(\"reason\", \"\"),\r\n        \"urgency\": params.get(\"urgency\", \"routine\"),\r\n        \"status\": \"active\",\r\n        \"valid_until\": (datetime.now() + timedelta(days=90)).strftime(\"%Y-%m-%d\"),\r\n        \"created_at\": datetime.now().isoformat()\r\n    }\r\n    \r\n    try:\r\n        table = dynamodb.Table(REFERRALS_TABLE)\r\n        table.put_item(Item=referral)\r\n    except Exception as e:\r\n        print(f\"Referral creation error: {e}\")\r\n    \r\n    return {\r\n        \"success\": True,\r\n        \"referral_id\": referral_id,\r\n        \"patient_name\": referral[\"patient_name\"],\r\n        \"specialty\": referral[\"specialty\"],\r\n        \"valid_until\": referral[\"valid_until\"],\r\n        \"message\": f\"GP referral {referral_id} created. Valid for 90 days. Patient can now book specialist appointment.\"\r\n    }\r\n\r\n\r\n# ============ Prescription Actions ============\r\n\r\ndef request_prescription(params):\r\n    \"\"\"Request a repeat prescription from GP surgery.\r\n    \r\n    Patients can request repeat prescriptions for ongoing medications.\r\n    \"\"\"\r\n    \r\n    patient_name = params.get(\"patient_name\", \"\")\r\n    nhs_number = params.get(\"nhs_number\", \"\")\r\n    medications = params.get(\"medications\", \"\")  # Comma-separated list\r\n    gp_surgery = params.get(\"gp_surgery\", \"\")\r\n    delivery_preference = params.get(\"delivery_preference\", \"collect\")  # collect or deliver\r\n    pharmacy_name = params.get(\"pharmacy_name\", \"\")\r\n    patient_address = params.get(\"patient_address\", \"\")\r\n    \r\n    if not patient_name:\r\n        return {\r\n            \"success\": False,\r\n            \"error\": \"Patient name is required\",\r\n            \"required_info\": [\"patient_name\", \"medications\"]\r\n        }\r\n    \r\n    if not medications:\r\n        return {\r\n            \"success\": False,\r\n            \"error\": \"Please specify which medications you need\",\r\n            \"required_info\": [\"medications\"],\r\n            \"example\": \"e.g., 'Metformin 500mg, Lisinopril 10mg'\"\r\n        }\r\n    \r\n    prescription_id = f\"RX-{datetime.now().strftime('%Y%m%d')}-{uuid.uuid4().hex[:6].upper()}\"\r\n    \r\n    # Parse medications list\r\n    med_list = [m.strip() for m in medications.split(\",\")]\r\n    \r\n    prescription = {\r\n        \"prescription_id\": prescription_id,\r\n        \"patient_name\": patient_name,\r\n        \"nhs_number\": nhs_number,\r\n        \"medications\": med_list,\r\n        \"gp_surgery\": gp_surgery or \"Main Street Surgery\",\r\n        \"delivery_preference\": delivery_preference,\r\n        \"pharmacy_name\": pharmacy_name,\r\n        \"patient_address\": patient_address,\r\n        \"status\": \"pending_approval\",\r\n        \"created_at\": datetime.now().isoformat(),\r\n        \"estimated_ready\": (datetime.now() + timedelta(days=2)).strftime(\"%Y-%m-%d\")\r\n    }\r\n    \r\n    try:\r\n        table = dynamodb.Table(PRESCRIPTIONS_TABLE)\r\n        table.put_item(Item=prescription)\r\n    except Exception as e:\r\n        print(f\"Prescription request error: {e}\")\r\n    \r\n    response = {\r\n        \"success\": True,\r\n        \"prescription_id\": prescription_id,\r\n        \"patient_name\": patient_name,\r\n        \"medications\": med_list,\r\n        \"status\": \"pending_approval\",\r\n        \"estimated_ready\": prescription[\"estimated_ready\"],\r\n        \"message\": f\"Prescription request {prescription_id} submitted. Your GP will review within 48 hours.\"\r\n    }\r\n    \r\n    if delivery_preference == \"deliver\" and patient_address:\r\n        response[\"delivery_info\"] = {\r\n            \"type\": \"home_delivery\",\r\n            \"address\": patient_address,\r\n            \"pharmacy\": pharmacy_name or \"To be assigned\",\r\n            \"note\": \"Pharmacy will contact you to arrange delivery\"\r\n        }\r\n    elif pharmacy_name:\r\n        response[\"collection_info\"] = {\r\n            \"type\": \"pharmacy_collection\",\r\n            \"pharmacy\": pharmacy_name,\r\n            \"note\": \"You will receive SMS when ready for collection\"\r\n        }\r\n    \r\n    return response\r\n\r\n\r\ndef check_prescription_status(params):\r\n    \"\"\"Check the status of a prescription request.\"\"\"\r\n    \r\n    prescription_id = params.get(\"prescription_id\", \"\")\r\n    patient_name = params.get(\"patient_name\", \"\")\r\n    \r\n    if not prescription_id and not patient_name:\r\n        return {\r\n            \"success\": False,\r\n            \"error\": \"Prescription ID or patient name required\"\r\n        }\r\n    \r\n    try:\r\n        table = dynamodb.Table(PRESCRIPTIONS_TABLE)\r\n        if prescription_id:\r\n            response = table.get_item(Key={\"prescription_id\": prescription_id})\r\n            prescription = response.get(\"Item\")\r\n        else:\r\n            prescription = None\r\n    except Exception as e:\r\n        print(f\"Prescription lookup error: {e}\")\r\n        prescription = None\r\n    \r\n    if prescription:\r\n        return {\r\n            \"success\": True,\r\n            \"prescription_id\": prescription[\"prescription_id\"],\r\n            \"patient_name\": prescription[\"patient_name\"],\r\n            \"medications\": prescription[\"medications\"],\r\n            \"status\": prescription[\"status\"],\r\n            \"estimated_ready\": prescription.get(\"estimated_ready\"),\r\n            \"pharmacy\": prescription.get(\"pharmacy_name\", \"Not assigned\"),\r\n            \"delivery_preference\": prescription.get(\"delivery_preference\")\r\n        }\r\n    \r\n    # Demo response for unknown prescriptions\r\n    return {\r\n        \"success\": True,\r\n        \"prescription_id\": prescription_id or \"Unknown\",\r\n        \"patient_name\": patient_name,\r\n        \"status\": \"not_found\",\r\n        \"message\": \"No prescription found. Please check the reference number or contact your GP surgery.\"\r\n    }\r\n\r\n\r\ndef request_pharmacy_delivery(params):\r\n    \"\"\"Request prescription delivery to home or specify collection pharmacy.\r\n    \r\n    Allows patients to choose between home delivery or pharmacy collection.\r\n    \"\"\"\r\n    \r\n    prescription_id = params.get(\"prescription_id\", \"\")\r\n    patient_name = params.get(\"patient_name\", \"\")\r\n    delivery_type = params.get(\"delivery_type\", \"collect\")  # \"deliver\" or \"collect\"\r\n    patient_address = params.get(\"patient_address\", \"\")\r\n    patient_postcode = params.get(\"patient_postcode\", \"\")\r\n    preferred_pharmacy = params.get(\"preferred_pharmacy\", \"\")\r\n    \r\n    if not patient_name:\r\n        return {\r\n            \"success\": False,\r\n            \"error\": \"Patient name is required\",\r\n            \"required_info\": [\"patient_name\", \"delivery_type\"]\r\n        }\r\n    \r\n    if delivery_type == \"deliver\" and not patient_address and not patient_postcode:\r\n        return {\r\n            \"success\": False,\r\n            \"error\": \"Delivery address required for home delivery\",\r\n            \"required_info\": [\"patient_address or patient_postcode\"],\r\n            \"alternative\": \"Choose 'collect' to pick up from a pharmacy instead\"\r\n        }\r\n    \r\n    delivery_id = f\"DEL-{datetime.now().strftime('%Y%m%d')}-{uuid.uuid4().hex[:6].upper()}\"\r\n    \r\n    if delivery_type == \"deliver\":\r\n        # Home delivery\r\n        full_address = patient_address or patient_postcode\r\n        \r\n        return {\r\n            \"success\": True,\r\n            \"delivery_id\": delivery_id,\r\n            \"prescription_id\": prescription_id,\r\n            \"patient_name\": patient_name,\r\n            \"delivery_type\": \"home_delivery\",\r\n            \"delivery_address\": full_address,\r\n            \"estimated_delivery\": (datetime.now() + timedelta(days=3)).strftime(\"%Y-%m-%d\"),\r\n            \"delivery_window\": \"9am - 6pm\",\r\n            \"tracking\": \"SMS updates will be sent\",\r\n            \"message\": f\"Home delivery arranged to {full_address}. Expected within 3 working days.\"\r\n        }\r\n    else:\r\n        # Pharmacy collection\r\n        if preferred_pharmacy:\r\n            pharmacy = preferred_pharmacy\r\n        else:\r\n            # Suggest nearest pharmacy based on postcode\r\n            pharmacy = \"Boots Pharmacy, High Street\" if patient_postcode else \"Your nominated pharmacy\"\r\n        \r\n        return {\r\n            \"success\": True,\r\n            \"delivery_id\": delivery_id,\r\n            \"prescription_id\": prescription_id,\r\n            \"patient_name\": patient_name,\r\n            \"delivery_type\": \"pharmacy_collection\",\r\n            \"pharmacy\": pharmacy,\r\n            \"ready_date\": (datetime.now() + timedelta(days=2)).strftime(\"%Y-%m-%d\"),\r\n            \"collection_hours\": \"Mon-Sat 9am-6pm\",\r\n            \"message\": f\"Prescription will be ready for collection at {pharmacy}. You'll receive SMS when ready.\"\r\n        }\r\n\r\n\r\ndef find_nearby_pharmacies(params):\r\n    \"\"\"Find nearby pharmacies for prescription collection.\r\n    \r\n    Uses patient address/postcode to find convenient pharmacies.\r\n    Returns pharmacy name, full address, distance, phone, opening hours, and services.\r\n    \"\"\"\r\n    \r\n    patient_name = params.get(\"patient_name\", \"\")\r\n    patient_address = params.get(\"patient_address\", \"\")\r\n    patient_postcode = params.get(\"patient_postcode\", \"\")\r\n    max_results = int(params.get(\"max_results\", 5))\r\n    \r\n    search_location = patient_address or patient_postcode\r\n    \r\n    if not search_location:\r\n        return {\r\n            \"success\": False,\r\n            \"error\": \"Address or postcode required to find nearby pharmacies\",\r\n            \"required_info\": [\"patient_address or patient_postcode\"]\r\n        }\r\n    \r\n    try:\r\n        # Try Amazon Location Service\r\n        geocode_response = location.geocode(\r\n            QueryText=search_location,\r\n            MaxResults=1,\r\n            Filter={\"IncludeCountries\": [\"GBR\"]}\r\n        )\r\n        \r\n        if geocode_response.get(\"ResultItems\"):\r\n            position = geocode_response[\"ResultItems\"][0][\"Position\"]\r\n            longitude, latitude = position[0], position[1]\r\n            \r\n            search_response = location.search_nearby(\r\n                QueryPosition=[longitude, latitude],\r\n                MaxResults=max_results,\r\n                Filter={\"IncludeCategories\": [\"pharmacy\", \"drugstore\"]}\r\n            )\r\n            \r\n            pharmacies = []\r\n            for item in search_response.get(\"ResultItems\", []):\r\n                # Extract full address\r\n                addr = item.get(\"Address\", {})\r\n                full_address = addr.get(\"Label\", \"\")\r\n                if not full_address:\r\n                    parts = []\r\n                    if addr.get(\"AddressNumber\"):\r\n                        parts.append(addr.get(\"AddressNumber\"))\r\n                    if addr.get(\"Street\"):\r\n                        parts.append(addr.get(\"Street\"))\r\n                    if addr.get(\"Locality\"):\r\n                        parts.append(addr.get(\"Locality\"))\r\n                    if addr.get(\"PostalCode\"):\r\n                        parts.append(addr.get(\"PostalCode\"))\r\n                    full_address = \", \".join(parts) if parts else \"Address not available\"\r\n                \r\n                # Extract phone\r\n                contacts = item.get(\"Contacts\", {})\r\n                phones = contacts.get(\"Phones\", [])\r\n                phone = phones[0].get(\"Value\", \"\") if phones else \"\"\r\n                \r\n                # Extract opening hours if available\r\n                opening_hours = item.get(\"OpeningHours\", {})\r\n                hours_display = _format_opening_hours(opening_hours)\r\n                \r\n                pharmacies.append({\r\n                    \"name\": item.get(\"Title\", \"Unknown Pharmacy\"),\r\n                    \"address\": full_address,\r\n                    \"postcode\": addr.get(\"PostalCode\", \"\"),\r\n                    \"distance_km\": round(item.get(\"Distance\", 0) / 1000, 1),\r\n                    \"phone\": phone,\r\n                    \"opening_hours\": hours_display,\r\n                    \"delivery_available\": True,\r\n                    \"services\": [\"NHS Prescriptions\", \"Repeat Prescriptions\"]\r\n                })\r\n            \r\n            if pharmacies:\r\n                return {\r\n                    \"success\": True,\r\n                    \"patient_name\": patient_name,\r\n                    \"search_location\": search_location,\r\n                    \"nearby_pharmacies\": pharmacies,\r\n                    \"message\": f\"Found {len(pharmacies)} pharmacies near {search_location}\",\r\n                    \"source\": \"Amazon Location Service\"\r\n                }\r\n            \r\n    except Exception as e:\r\n        print(f\"Location Service error: {e}\")\r\n    \r\n    # Fallback to curated pharmacy data\r\n    return _get_pharmacies_for_area(patient_name, search_location)\r\n\r\n\r\ndef _format_opening_hours(opening_hours):\r\n    \"\"\"Format opening hours from Location Service response.\"\"\"\r\n    if not opening_hours:\r\n        return \"Contact pharmacy for hours\"\r\n    \r\n    # Try to extract display string\r\n    display = opening_hours.get(\"Display\", [])\r\n    if display:\r\n        return \"; \".join(display[:3])\r\n    \r\n    return \"Mon-Sat 9am-6pm (typical)\"\r\n\r\n\r\ndef _get_pharmacies_for_area(patient_name, search_location):\r\n    \"\"\"Return curated pharmacy data based on area.\r\n    \r\n    Uses postcode prefix to return relevant pharmacies with full addresses.\r\n    \"\"\"\r\n    postcode_area = _extract_postcode_area(search_location)\r\n    \r\n    # Curated pharmacy data by London area with full addresses\r\n    pharmacies_by_area = {\r\n        \"SE\": [\r\n            {\r\n                \"name\": \"Boots Pharmacy - London Bridge\",\r\n                \"address\": \"4-6 London Bridge Walk, London SE1 2SX\",\r\n                \"postcode\": \"SE1 2SX\",\r\n                \"distance_km\": 0.3,\r\n                \"phone\": \"020 7403 5773\",\r\n                \"opening_hours\": \"Mon-Fri 7:30am-8pm, Sat 9am-7pm, Sun 11am-5pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Flu Jabs\", \"Health Checks\", \"Travel Vaccines\"]\r\n            },\r\n            {\r\n                \"name\": \"Lloyds Pharmacy - Borough\",\r\n                \"address\": \"55 Borough High Street, London SE1 1NB\",\r\n                \"postcode\": \"SE1 1NB\",\r\n                \"distance_km\": 0.5,\r\n                \"phone\": \"020 7407 1525\",\r\n                \"opening_hours\": \"Mon-Fri 9am-6:30pm, Sat 9am-1pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Repeat Prescriptions\", \"Medicine Reviews\"]\r\n            },\r\n            {\r\n                \"name\": \"Superdrug Pharmacy - Elephant \u0026 Castle\",\r\n                \"address\": \"Unit 12, Elephant \u0026 Castle Shopping Centre, London SE1 6TE\",\r\n                \"postcode\": \"SE1 6TE\",\r\n                \"distance_km\": 0.8,\r\n                \"phone\": \"020 7703 5892\",\r\n                \"opening_hours\": \"Mon-Sat 9am-7pm, Sun 11am-5pm\",\r\n                \"delivery_available\": False,\r\n                \"services\": [\"NHS Prescriptions\", \"Health Checks\"]\r\n            },\r\n            {\r\n                \"name\": \"Day Lewis Pharmacy - Bermondsey\",\r\n                \"address\": \"172 Jamaica Road, Bermondsey, London SE16 4RT\",\r\n                \"postcode\": \"SE16 4RT\",\r\n                \"distance_km\": 1.2,\r\n                \"phone\": \"020 7237 2876\",\r\n                \"opening_hours\": \"Mon-Fri 9am-6pm, Sat 9am-1pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Blister Packs\", \"Delivery Service\"]\r\n            },\r\n            {\r\n                \"name\": \"Well Pharmacy - Peckham\",\r\n                \"address\": \"89 Peckham High Street, London SE15 5RS\",\r\n                \"postcode\": \"SE15 5RS\",\r\n                \"distance_km\": 2.1,\r\n                \"phone\": \"020 7639 1234\",\r\n                \"opening_hours\": \"Mon-Fri 9am-6:30pm, Sat 9am-5pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Medicine Reviews\", \"Minor Ailments\"]\r\n            }\r\n        ],\r\n        \"SW\": [\r\n            {\r\n                \"name\": \"Boots Pharmacy - Victoria Station\",\r\n                \"address\": \"Victoria Station, Terminus Place, London SW1V 1JT\",\r\n                \"postcode\": \"SW1V 1JT\",\r\n                \"distance_km\": 0.4,\r\n                \"phone\": \"020 7834 6126\",\r\n                \"opening_hours\": \"Mon-Fri 7am-9pm, Sat 8am-8pm, Sun 9am-6pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Travel Clinic\", \"Flu Jabs\"]\r\n            },\r\n            {\r\n                \"name\": \"John Bell \u0026 Croyden\",\r\n                \"address\": \"50-54 Wigmore Street, London W1U 2AU\",\r\n                \"postcode\": \"W1U 2AU\",\r\n                \"distance_km\": 0.6,\r\n                \"phone\": \"020 7935 5555\",\r\n                \"opening_hours\": \"Mon-Fri 9am-6:30pm, Sat 9:30am-6pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Specialist Medicines\", \"Compounding\"]\r\n            },\r\n            {\r\n                \"name\": \"Lloyds Pharmacy - Chelsea\",\r\n                \"address\": \"298 King's Road, Chelsea, London SW3 5UG\",\r\n                \"postcode\": \"SW3 5UG\",\r\n                \"distance_km\": 1.0,\r\n                \"phone\": \"020 7352 8931\",\r\n                \"opening_hours\": \"Mon-Fri 9am-7pm, Sat 9am-6pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Private Prescriptions\"]\r\n            },\r\n            {\r\n                \"name\": \"Clapham Pharmacy\",\r\n                \"address\": \"87 Clapham High Street, London SW4 7TB\",\r\n                \"postcode\": \"SW4 7TB\",\r\n                \"distance_km\": 1.8,\r\n                \"phone\": \"020 7622 1234\",\r\n                \"opening_hours\": \"Mon-Sat 9am-6:30pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Repeat Prescriptions\"]\r\n            },\r\n            {\r\n                \"name\": \"Wandsworth Pharmacy\",\r\n                \"address\": \"45 Wandsworth High Street, London SW18 2PT\",\r\n                \"postcode\": \"SW18 2PT\",\r\n                \"distance_km\": 2.5,\r\n                \"phone\": \"020 8874 5678\",\r\n                \"opening_hours\": \"Mon-Fri 9am-6pm, Sat 9am-1pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Blister Packs\"]\r\n            }\r\n        ],\r\n        \"W\": [\r\n            {\r\n                \"name\": \"Boots Pharmacy - Westfield\",\r\n                \"address\": \"Westfield London, Ariel Way, London W12 7GF\",\r\n                \"postcode\": \"W12 7GF\",\r\n                \"distance_km\": 0.5,\r\n                \"phone\": \"020 8743 5566\",\r\n                \"opening_hours\": \"Mon-Sat 10am-10pm, Sun 12pm-6pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Health Checks\", \"Flu Jabs\"]\r\n            },\r\n            {\r\n                \"name\": \"Zafash Pharmacy - Kensington\",\r\n                \"address\": \"233-235 Old Brompton Road, London SW5 0EA\",\r\n                \"postcode\": \"SW5 0EA\",\r\n                \"distance_km\": 0.8,\r\n                \"phone\": \"020 7373 2798\",\r\n                \"opening_hours\": \"24 Hours\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"24hr Service\", \"Emergency Supply\"]\r\n            },\r\n            {\r\n                \"name\": \"Lloyds Pharmacy - Notting Hill\",\r\n                \"address\": \"63 Notting Hill Gate, London W11 3JS\",\r\n                \"postcode\": \"W11 3JS\",\r\n                \"distance_km\": 1.2,\r\n                \"phone\": \"020 7727 6116\",\r\n                \"opening_hours\": \"Mon-Fri 9am-7pm, Sat 9am-6pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Travel Vaccines\"]\r\n            }\r\n        ],\r\n        \"N\": [\r\n            {\r\n                \"name\": \"Boots Pharmacy - Angel\",\r\n                \"address\": \"21 Islington High Street, London N1 9LQ\",\r\n                \"postcode\": \"N1 9LQ\",\r\n                \"distance_km\": 0.4,\r\n                \"phone\": \"020 7837 5432\",\r\n                \"opening_hours\": \"Mon-Sat 8am-8pm, Sun 11am-5pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Flu Jabs\", \"Health Checks\"]\r\n            },\r\n            {\r\n                \"name\": \"Lloyds Pharmacy - Camden\",\r\n                \"address\": \"178 Camden High Street, London NW1 8QS\",\r\n                \"postcode\": \"NW1 8QS\",\r\n                \"distance_km\": 0.7,\r\n                \"phone\": \"020 7485 1234\",\r\n                \"opening_hours\": \"Mon-Sat 9am-7pm, Sun 10am-4pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Repeat Prescriptions\"]\r\n            },\r\n            {\r\n                \"name\": \"Hampstead Pharmacy\",\r\n                \"address\": \"56 Hampstead High Street, London NW3 1QH\",\r\n                \"postcode\": \"NW3 1QH\",\r\n                \"distance_km\": 1.5,\r\n                \"phone\": \"020 7435 6789\",\r\n                \"opening_hours\": \"Mon-Fri 9am-6:30pm, Sat 9am-5pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Specialist Medicines\"]\r\n            }\r\n        ],\r\n        \"E\": [\r\n            {\r\n                \"name\": \"Boots Pharmacy - Stratford Westfield\",\r\n                \"address\": \"Westfield Stratford City, London E20 1EJ\",\r\n                \"postcode\": \"E20 1EJ\",\r\n                \"distance_km\": 0.5,\r\n                \"phone\": \"020 8555 1234\",\r\n                \"opening_hours\": \"Mon-Sat 9am-9pm, Sun 12pm-6pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Health Checks\", \"Flu Jabs\"]\r\n            },\r\n            {\r\n                \"name\": \"Lloyds Pharmacy - Whitechapel\",\r\n                \"address\": \"85 Whitechapel Road, London E1 1DU\",\r\n                \"postcode\": \"E1 1DU\",\r\n                \"distance_km\": 0.6,\r\n                \"phone\": \"020 7247 5678\",\r\n                \"opening_hours\": \"Mon-Sat 9am-7pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Repeat Prescriptions\"]\r\n            },\r\n            {\r\n                \"name\": \"Well Pharmacy - Hackney\",\r\n                \"address\": \"123 Mare Street, Hackney, London E8 3RH\",\r\n                \"postcode\": \"E8 3RH\",\r\n                \"distance_km\": 1.2,\r\n                \"phone\": \"020 8985 4321\",\r\n                \"opening_hours\": \"Mon-Fri 9am-6:30pm, Sat 9am-5pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Medicine Reviews\"]\r\n            }\r\n        ],\r\n        \"DEFAULT\": [\r\n            {\r\n                \"name\": \"Boots Pharmacy - Oxford Street\",\r\n                \"address\": \"361 Oxford Street, London W1C 2JL\",\r\n                \"postcode\": \"W1C 2JL\",\r\n                \"distance_km\": 1.0,\r\n                \"phone\": \"020 7491 8546\",\r\n                \"opening_hours\": \"Mon-Sat 8am-9pm, Sun 12pm-6pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Health Checks\", \"Travel Clinic\"]\r\n            },\r\n            {\r\n                \"name\": \"Zafash Pharmacy - 24hr\",\r\n                \"address\": \"233-235 Old Brompton Road, London SW5 0EA\",\r\n                \"postcode\": \"SW5 0EA\",\r\n                \"distance_km\": 2.0,\r\n                \"phone\": \"020 7373 2798\",\r\n                \"opening_hours\": \"24 Hours\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"24hr Service\", \"Emergency Supply\"]\r\n            },\r\n            {\r\n                \"name\": \"Lloyds Pharmacy - Charing Cross\",\r\n                \"address\": \"5 Villiers Street, London WC2N 6NE\",\r\n                \"postcode\": \"WC2N 6NE\",\r\n                \"distance_km\": 1.5,\r\n                \"phone\": \"020 7930 4761\",\r\n                \"opening_hours\": \"Mon-Fri 8am-7pm, Sat 9am-5pm\",\r\n                \"delivery_available\": True,\r\n                \"services\": [\"NHS Prescriptions\", \"Repeat Prescriptions\"]\r\n            }\r\n        ]\r\n    }\r\n    \r\n    # Get pharmacies for the area\r\n    pharmacies = pharmacies_by_area.get(postcode_area, pharmacies_by_area[\"DEFAULT\"])\r\n    \r\n    return {\r\n        \"success\": True,\r\n        \"patient_name\": patient_name,\r\n        \"search_location\": search_location,\r\n        \"nearby_pharmacies\": pharmacies[:5],\r\n        \"message\": f\"Found {len(pharmacies[:5])} pharmacies near {search_location}\",\r\n        \"source\": \"NHS Pharmacy Directory\",\r\n        \"note\": \"Most pharmacies offer free NHS prescription collection and delivery services.\"\r\n    }\r\n\r\n\r\ndef _mock_nearby_pharmacies(patient_name, search_location):\r\n    \"\"\"Legacy function - redirects to new pharmacy lookup.\"\"\"\r\n    return _get_pharmacies_for_area(patient_name, search_location)\r\n",
                "filename": "lambda_actions.py"
              }
            ],
            "source_content": null,
            "source_content_filename": null,
            "source_dir": null,
            "source_file": null,
            "type": "zip"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_caller_identity",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "account_id": "376337229415",
            "arn": "arn:aws:iam::376337229415:user/ryankarlos",
            "id": "376337229415",
            "user_id": "AIDAVPH3SMZTWPJBBVECF"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_region",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "US East (N. Virginia)",
            "endpoint": "ec2.us-east-1.amazonaws.com",
            "id": "us-east-1",
            "name": "us-east-1",
            "region": "us-east-1"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent",
      "name": "information",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_arn": "arn:aws:bedrock:us-east-1:376337229415:agent/E90JQ9YHKP",
            "agent_collaboration": "DISABLED",
            "agent_id": "E90JQ9YHKP",
            "agent_name": "nhs-booking-demo-info-agent",
            "agent_resource_role_arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-bedrock-agent-role",
            "agent_version": null,
            "customer_encryption_key_arn": null,
            "description": "Information specialist for NHS queries",
            "foundation_model": "amazon.nova-lite-v1:0",
            "guardrail_configuration": null,
            "id": "E90JQ9YHKP",
            "idle_session_ttl_in_seconds": 300,
            "instruction": "You are an NHS Information Specialist. Your role is to answer questions about NHS services.\r\n\r\nRESPONSIBILITIES:\r\n1. Search the knowledge base for NHS information\r\n2. Explain appointment types (GP, specialist, urgent, routine)\r\n3. Describe what patients should bring to appointments\r\n4. Explain the patient flow and booking process\r\n5. Provide information about nearby facilities\r\n\r\nIMPORTANT:\r\n- You do NOT provide medical advice\r\n- For health questions, direct patients to NHS 111 or nhs.uk\r\n- Always cite the knowledge base when providing information\r\n- Be helpful and reassuring in your responses\r\n",
            "memory_configuration": null,
            "prepare_agent": true,
            "prepared_at": "2026-01-05T23:22:27Z",
            "prompt_override_configuration": [
              {
                "override_lambda": null,
                "prompt_configurations": null
              }
            ],
            "region": "us-east-1",
            "skip_resource_in_use_check": false,
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_iam_role.bedrock_agent",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent",
      "name": "scheduling",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_arn": "arn:aws:bedrock:us-east-1:376337229415:agent/9ESYPRBHBS",
            "agent_collaboration": "DISABLED",
            "agent_id": "9ESYPRBHBS",
            "agent_name": "nhs-booking-demo-scheduling-agent",
            "agent_resource_role_arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-bedrock-agent-role",
            "agent_version": null,
            "customer_encryption_key_arn": null,
            "description": "Scheduling specialist for booking appointments",
            "foundation_model": "amazon.nova-lite-v1:0",
            "guardrail_configuration": null,
            "id": "9ESYPRBHBS",
            "idle_session_ttl_in_seconds": 300,
            "instruction": "You are an NHS Scheduling Specialist. Your role is to find and book appointments, handle prescriptions, and manage pharmacy delivery.\r\n\r\nRESPONSIBILITIES:\r\n1. Check availability based on urgency level from triage\r\n2. Present multiple options to patients (different times, doctors, locations)\r\n3. Handle booking conflicts by offering alternatives\r\n4. Create and confirm bookings\r\n5. Find nearby hospitals when patients need alternatives\r\n6. Process repeat prescription requests\r\n7. Arrange pharmacy delivery or collection\r\n\r\nGP REFERRAL CHECK:\r\nBefore booking SPECIALIST or HOSPITAL appointments:\r\n- Use validateReferral to check if patient has valid GP referral\r\n- If no referral, explain they need GP appointment first\r\n- Exception: Self-referral services (A\u0026E, sexual health, NHS talking therapies)\r\n\r\nWHEN SLOTS ARE UNAVAILABLE:\r\n- Never simply reject a request\r\n- Offer alternative times on the same day\r\n- Suggest different doctors with earlier availability\r\n- Recommend nearby clinics or hospitals\r\n- For urgent cases, escalate to find emergency slots\r\n\r\nFINDING NEARBY HOSPITALS:\r\nWhen a patient needs to find nearby NHS facilities:\r\n1. Ask for their full name if not provided\r\n2. Ask for their full address including postcode\r\n3. Use findNearbyHospitals action with their details\r\n4. Present results with distance and available services\r\n\r\nPRESCRIPTION WORKFLOW:\r\nWhen patient requests repeat prescription:\r\n1. Ask for patient name and medications needed\r\n2. Use requestPrescription action\r\n3. Ask: \"Would you like home delivery or pharmacy collection?\"\r\n4. For delivery: Ask for full address with postcode\r\n5. For collection: Use findNearbyPharmacies to show options\r\n6. Use requestPharmacyDelivery to confirm arrangement\r\n\r\nBOOKING CONFIRMATION:\r\n- Verify all patient details before confirming\r\n- Provide clear booking reference\r\n- Explain what to bring to the appointment\r\n",
            "memory_configuration": null,
            "prepare_agent": true,
            "prepared_at": "2026-01-06T00:17:57Z",
            "prompt_override_configuration": [
              {
                "override_lambda": null,
                "prompt_configurations": null
              }
            ],
            "region": "us-east-1",
            "skip_resource_in_use_check": false,
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_iam_role.bedrock_agent",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent",
      "name": "supervisor",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_arn": "arn:aws:bedrock:us-east-1:376337229415:agent/P7QFL8LKUN",
            "agent_collaboration": "DISABLED",
            "agent_id": "P7QFL8LKUN",
            "agent_name": "nhs-booking-demo-agent",
            "agent_resource_role_arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-bedrock-agent-role",
            "agent_version": null,
            "customer_encryption_key_arn": null,
            "description": "NHS Patient Booking Assistant with Web Search",
            "foundation_model": "us.amazon.nova-premier-v1:0",
            "guardrail_configuration": null,
            "id": "P7QFL8LKUN",
            "idle_session_ttl_in_seconds": 600,
            "instruction": "You are an NHS Patient Booking Assistant. Help patients book GP and specialist appointments, request prescriptions, and find nearby pharmacies.\r\n\r\nIMPORTANT RULES:\r\n1. You do NOT provide medical advice - only help with bookings and prescriptions\r\n2. Be polite, professional, and reassuring\r\n3. Keep patients updated on what you're doing\r\n\r\nBOOKING WORKFLOW:\r\n1. Understand the patient's booking need (GP or specialist)\r\n2. For SPECIALIST/HOSPITAL appointments: Check if patient has GP referral using validateReferral\r\n   - If no referral, explain they need to see GP first (unless self-referral service)\r\n3. Check availability using the checkAvailability action\r\n4. Create the booking using createBooking action\r\n5. Approve it using approveBooking action\r\n6. Send confirmation using sendConfirmation action\r\n\r\nGP REFERRAL REQUIREMENTS:\r\n- Most specialist and hospital appointments require a GP referral\r\n- Always check for valid referral before booking specialist appointments\r\n- Self-referral services (no GP needed): A\u0026E, sexual health, NHS talking therapies, drug/alcohol services\r\n- If no referral exists, guide patient to book GP appointment first\r\n\r\nPRESCRIPTION REQUESTS:\r\nWhen a patient wants to request a repeat prescription:\r\n1. Ask for their full name\r\n2. Ask which medications they need (name and dosage if known)\r\n3. Use requestPrescription action\r\n4. Ask if they want home delivery or pharmacy collection\r\n5. If delivery: ask for full address including postcode\r\n6. If collection: use findNearbyPharmacies to help them choose, or ask for preferred pharmacy\r\n7. Use requestPharmacyDelivery to arrange delivery/collection\r\n\r\nFINDING NEARBY HOSPITALS:\r\nWhen a patient asks about nearby hospitals, clinics, or NHS facilities:\r\n1. First ask for their full name if not already provided\r\n2. Ask for their full address including postcode (e.g., \"10 Downing Street, London SW1A 2AA\")\r\n3. Use the findNearbyHospitals action with their name and address\r\n4. Present the results showing hospital name, distance, and services available\r\n\r\nFINDING NEARBY PHARMACIES:\r\nWhen a patient needs to find a pharmacy:\r\n1. Ask for their address or postcode\r\n2. Use findNearbyPharmacies action\r\n3. Show pharmacies with distance, opening hours, and delivery options\r\n\r\nWEB SEARCH:\r\nYou have access to real-time web search. Use it to:\r\n- Find current NHS service information and opening hours\r\n- Look up specific hospital or clinic details\r\n- Get up-to-date NHS guidance and policies\r\n- Search for NHS services in specific areas\r\nAlways cite your sources when providing web search results.\r\n\r\nEMERGENCY: For urgent symptoms (chest pain, breathing difficulty, stroke signs), \r\nimmediately advise calling 999 - do NOT proceed with booking.\r\n\r\nWhen patients ask about NHS services, appointment types, or patient flow:\r\n- First search the knowledge base for relevant information\r\n- Use web search for current/real-time information\r\n- Always clarify you cannot give medical advice\r\n",
            "memory_configuration": null,
            "prepare_agent": true,
            "prepared_at": "2026-01-06T00:28:41Z",
            "prompt_override_configuration": [
              {
                "override_lambda": null,
                "prompt_configurations": null
              }
            ],
            "region": "us-east-1",
            "skip_resource_in_use_check": false,
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_iam_role.bedrock_agent",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent",
      "name": "supervisor_multi",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_arn": "arn:aws:bedrock:us-east-1:376337229415:agent/R5CKKTHOFB",
            "agent_collaboration": "SUPERVISOR",
            "agent_id": "R5CKKTHOFB",
            "agent_name": "nhs-booking-demo-supervisor",
            "agent_resource_role_arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-bedrock-agent-role",
            "agent_version": null,
            "customer_encryption_key_arn": null,
            "description": "Supervisor agent with web search orchestrating NHS booking workflow",
            "foundation_model": "us.amazon.nova-premier-v1:0",
            "guardrail_configuration": null,
            "id": "R5CKKTHOFB",
            "idle_session_ttl_in_seconds": 600,
            "instruction": "You are the NHS Patient Booking Supervisor. You coordinate a team of specialist agents.\r\n\r\nYOUR TEAM:\r\n1. TRIAGE AGENT - Assesses urgency of patient requests\r\n2. SCHEDULING AGENT - Handles availability and bookings  \r\n3. INFORMATION AGENT - Answers questions about NHS services\r\n\r\nWORKFLOW:\r\n1. Greet the patient warmly\r\n2. If patient describes symptoms or health concerns:\r\n   - Route to TRIAGE AGENT to assess urgency\r\n   - If emergency, advise 999 immediately\r\n3. For booking requests:\r\n   - Get urgency from TRIAGE if not already assessed\r\n   - Route to SCHEDULING AGENT to find slots and book\r\n4. For questions about NHS services:\r\n   - Route to INFORMATION AGENT\r\n   - Use web search for current/real-time NHS information\r\n5. Summarize outcomes and confirm next steps with patient\r\n\r\nWEB SEARCH:\r\nYou have access to real-time web search. Use it to:\r\n- Find current NHS service information and opening hours\r\n- Look up specific hospital or clinic details\r\n- Get up-to-date NHS guidance and policies\r\n- Search for NHS services in specific areas\r\nAlways cite your sources when providing web search results.\r\n\r\nIMPORTANT:\r\n- Keep the patient informed about what you're doing\r\n- Be empathetic and professional\r\n- Never provide medical advice yourself\r\n- Ensure smooth handoffs between agents\r\n",
            "memory_configuration": null,
            "prepare_agent": false,
            "prepared_at": "2026-01-06T00:17:58Z",
            "prompt_override_configuration": [
              {
                "override_lambda": null,
                "prompt_configurations": null
              }
            ],
            "region": "us-east-1",
            "skip_resource_in_use_check": false,
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_iam_role.bedrock_agent",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent",
      "name": "triage",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_arn": "arn:aws:bedrock:us-east-1:376337229415:agent/MR73PAVETH",
            "agent_collaboration": "DISABLED",
            "agent_id": "MR73PAVETH",
            "agent_name": "nhs-booking-demo-triage-agent",
            "agent_resource_role_arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-bedrock-agent-role",
            "agent_version": null,
            "customer_encryption_key_arn": null,
            "description": "Triage specialist for assessing patient urgency",
            "foundation_model": "amazon.nova-lite-v1:0",
            "guardrail_configuration": null,
            "id": "MR73PAVETH",
            "idle_session_ttl_in_seconds": 300,
            "instruction": "You are an NHS Triage Specialist. Your role is to assess patient requests and determine urgency.\r\n\r\nTRIAGE CATEGORIES:\r\n1. EMERGENCY - Chest pain, breathing difficulty, stroke symptoms, severe bleeding\r\n   Action: Immediately advise calling 999, do not proceed with booking\r\n    \r\n2. URGENT - High fever, severe pain, worsening symptoms, mental health crisis\r\n   Action: Same-day or next-day appointment required\r\n    \r\n3. ROUTINE - Ongoing conditions, follow-ups, general health concerns\r\n   Action: Standard appointment within 1-2 weeks\r\n\r\nASSESSMENT PROCESS:\r\n- Ask clarifying questions about symptoms if needed\r\n- Consider duration and severity of symptoms\r\n- Check for red flag symptoms that require emergency care\r\n- Return urgency level and recommended appointment type\r\n\r\nYou do NOT provide medical advice or diagnoses. Only assess urgency for booking purposes.\r\n",
            "memory_configuration": null,
            "prepare_agent": true,
            "prepared_at": "2026-01-05T23:22:28Z",
            "prompt_override_configuration": [
              {
                "override_lambda": null,
                "prompt_configurations": null
              }
            ],
            "region": "us-east-1",
            "skip_resource_in_use_check": false,
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_iam_role.bedrock_agent",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_action_group",
      "name": "booking",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "action_group_executor": [
              {
                "custom_control": null,
                "lambda": "arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions"
              }
            ],
            "action_group_id": "RS93P9JKFW",
            "action_group_name": "BookingActions",
            "action_group_state": "ENABLED",
            "agent_id": "P7QFL8LKUN",
            "agent_version": "DRAFT",
            "api_schema": [
              {
                "payload": "{\"info\":{\"title\":\"NHS Booking API\",\"version\":\"1.0.0\"},\"openapi\":\"3.0.0\",\"paths\":{\"/approve-booking\":{\"post\":{\"description\":\"Approve and confirm a booking\",\"operationId\":\"approveBooking\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"booking_id\":{\"description\":\"Booking reference\",\"type\":\"string\"}},\"required\":[\"booking_id\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Booking approved\"}}}},\"/check-availability\":{\"post\":{\"description\":\"Check available appointment slots for GP or specialist\",\"operationId\":\"checkAvailability\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"appointment_type\":{\"description\":\"gp or specialist\",\"type\":\"string\"},\"urgency\":{\"description\":\"routine or urgent\",\"type\":\"string\"}},\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Available slots returned\"}}}},\"/check-prescription-status\":{\"post\":{\"description\":\"Check the status of a prescription request\",\"operationId\":\"checkPrescriptionStatus\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"patient_name\":{\"description\":\"Patient name (alternative to prescription_id)\",\"type\":\"string\"},\"prescription_id\":{\"description\":\"Prescription reference number\",\"type\":\"string\"}},\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Prescription status\"}}}},\"/create-booking\":{\"post\":{\"description\":\"Create a new appointment booking\",\"operationId\":\"createBooking\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"appointment_type\":{\"description\":\"gp or specialist\",\"type\":\"string\"},\"date\":{\"description\":\"Date YYYY-MM-DD\",\"type\":\"string\"},\"patient_name\":{\"description\":\"Patient full name\",\"type\":\"string\"},\"reason\":{\"description\":\"Reason for appointment\",\"type\":\"string\"},\"time\":{\"description\":\"Time HH:MM\",\"type\":\"string\"}},\"required\":[\"patient_name\",\"date\",\"time\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Booking created\"}}}},\"/find-nearby-hospitals\":{\"post\":{\"description\":\"Find nearby NHS hospitals and clinics based on patient address. IMPORTANT: You must ask the patient for their name and full address (including postcode) before calling this action.\",\"operationId\":\"findNearbyHospitals\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"max_results\":{\"description\":\"Maximum number of hospitals to return (default 5)\",\"type\":\"integer\"},\"patient_address\":{\"description\":\"Patient full address including postcode (e.g., '10 Downing Street, London SW1A 2AA')\",\"type\":\"string\"},\"patient_name\":{\"description\":\"Patient full name\",\"type\":\"string\"}},\"required\":[\"patient_name\",\"patient_address\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"List of nearby hospitals with distance and contact info\"}}}},\"/find-nearby-pharmacies\":{\"post\":{\"description\":\"Find nearby pharmacies for prescription collection. Ask patient for address or postcode.\",\"operationId\":\"findNearbyPharmacies\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"max_results\":{\"description\":\"Maximum pharmacies to return (default 5)\",\"type\":\"integer\"},\"patient_address\":{\"description\":\"Patient address\",\"type\":\"string\"},\"patient_name\":{\"description\":\"Patient full name\",\"type\":\"string\"},\"patient_postcode\":{\"description\":\"Patient postcode (alternative to full address)\",\"type\":\"string\"}},\"required\":[\"patient_name\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"List of nearby pharmacies\"}}}},\"/request-pharmacy-delivery\":{\"post\":{\"description\":\"Arrange prescription delivery to home or collection from pharmacy\",\"operationId\":\"requestPharmacyDelivery\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"delivery_type\":{\"description\":\"'deliver' for home delivery or 'collect' for pharmacy pickup\",\"type\":\"string\"},\"patient_address\":{\"description\":\"Full delivery address (required for home delivery)\",\"type\":\"string\"},\"patient_name\":{\"description\":\"Patient full name\",\"type\":\"string\"},\"patient_postcode\":{\"description\":\"Postcode (alternative to full address)\",\"type\":\"string\"},\"preferred_pharmacy\":{\"description\":\"Preferred pharmacy name for collection\",\"type\":\"string\"},\"prescription_id\":{\"description\":\"Prescription reference (optional)\",\"type\":\"string\"}},\"required\":[\"patient_name\",\"delivery_type\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Delivery/collection arrangement confirmed\"}}}},\"/request-prescription\":{\"post\":{\"description\":\"Request a repeat prescription from GP surgery. Ask patient for medications needed.\",\"operationId\":\"requestPrescription\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"delivery_preference\":{\"description\":\"'deliver' for home delivery or 'collect' for pharmacy collection\",\"type\":\"string\"},\"gp_surgery\":{\"description\":\"GP surgery name (optional)\",\"type\":\"string\"},\"medications\":{\"description\":\"Comma-separated list of medications (e.g., 'Metformin 500mg, Lisinopril 10mg')\",\"type\":\"string\"},\"nhs_number\":{\"description\":\"Patient NHS number (optional)\",\"type\":\"string\"},\"patient_address\":{\"description\":\"Full address for home delivery (required if delivery_preference is 'deliver')\",\"type\":\"string\"},\"patient_name\":{\"description\":\"Patient full name\",\"type\":\"string\"},\"pharmacy_name\":{\"description\":\"Preferred pharmacy for collection (optional)\",\"type\":\"string\"}},\"required\":[\"patient_name\",\"medications\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Prescription request submitted\"}}}},\"/send-confirmation\":{\"post\":{\"description\":\"Send booking confirmation via email/SMS\",\"operationId\":\"sendConfirmation\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"booking_id\":{\"description\":\"Booking reference\",\"type\":\"string\"},\"email\":{\"description\":\"Patient email\",\"type\":\"string\"},\"phone\":{\"description\":\"Patient phone\",\"type\":\"string\"}},\"required\":[\"booking_id\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Confirmation sent\"}}}},\"/validate-referral\":{\"post\":{\"description\":\"Check if patient has a valid GP referral for specialist/hospital appointment. MUST be called before booking specialist appointments.\",\"operationId\":\"validateReferral\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"nhs_number\":{\"description\":\"Patient NHS number (optional)\",\"type\":\"string\"},\"patient_name\":{\"description\":\"Patient full name\",\"type\":\"string\"},\"specialty\":{\"description\":\"Specialty being referred to (e.g., cardiology, dermatology)\",\"type\":\"string\"}},\"required\":[\"patient_name\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Referral validation result\"}}}}}}",
                "s3": []
              }
            ],
            "description": "Actions for booking appointments",
            "function_schema": [],
            "id": "RS93P9JKFW,P7QFL8LKUN,DRAFT",
            "parent_action_group_signature": null,
            "prepare_agent": true,
            "region": "us-east-1",
            "skip_resource_in_use_check": false,
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.supervisor",
            "aws_dynamodb_table.bookings",
            "aws_dynamodb_table.prescriptions",
            "aws_dynamodb_table.referrals",
            "aws_dynamodb_table.sessions",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role.lambda",
            "aws_lambda_function.actions",
            "data.archive_file.lambda",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_action_group",
      "name": "scheduling_actions",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "action_group_executor": [
              {
                "custom_control": null,
                "lambda": "arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions"
              }
            ],
            "action_group_id": "FDKEJYAI7X",
            "action_group_name": "SchedulingActions",
            "action_group_state": "ENABLED",
            "agent_id": "9ESYPRBHBS",
            "agent_version": "DRAFT",
            "api_schema": [
              {
                "payload": "{\"info\":{\"title\":\"NHS Scheduling API\",\"version\":\"1.0.0\"},\"openapi\":\"3.0.0\",\"paths\":{\"/approve-booking\":{\"post\":{\"description\":\"Approve and confirm booking\",\"operationId\":\"approveBooking\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"booking_id\":{\"type\":\"string\"}},\"required\":[\"booking_id\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Booking approved\"}}}},\"/check-availability\":{\"post\":{\"description\":\"Check available appointment slots\",\"operationId\":\"checkAvailability\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"appointment_type\":{\"type\":\"string\"},\"preferred_date\":{\"type\":\"string\"},\"preferred_doctor\":{\"type\":\"string\"},\"urgency\":{\"type\":\"string\"}},\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Available slots\"}}}},\"/create-booking\":{\"post\":{\"description\":\"Create appointment booking\",\"operationId\":\"createBooking\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"date\":{\"type\":\"string\"},\"doctor\":{\"type\":\"string\"},\"patient_name\":{\"type\":\"string\"},\"reason\":{\"type\":\"string\"},\"time\":{\"type\":\"string\"}},\"required\":[\"patient_name\",\"date\",\"time\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Booking created\"}}}},\"/find-nearby-hospitals\":{\"post\":{\"description\":\"Find nearby NHS hospitals and clinics. Ask patient for name and full address with postcode first.\",\"operationId\":\"findNearbyHospitals\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"max_results\":{\"type\":\"integer\"},\"patient_address\":{\"description\":\"Full address with postcode\",\"type\":\"string\"},\"patient_name\":{\"description\":\"Patient full name\",\"type\":\"string\"}},\"required\":[\"patient_name\",\"patient_address\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Nearby hospitals\"}}}},\"/find-nearby-pharmacies\":{\"post\":{\"description\":\"Find nearby pharmacies for prescription collection\",\"operationId\":\"findNearbyPharmacies\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"max_results\":{\"type\":\"integer\"},\"patient_address\":{\"type\":\"string\"},\"patient_name\":{\"type\":\"string\"},\"patient_postcode\":{\"type\":\"string\"}},\"required\":[\"patient_name\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Nearby pharmacies\"}}}},\"/request-pharmacy-delivery\":{\"post\":{\"description\":\"Arrange prescription home delivery or pharmacy collection\",\"operationId\":\"requestPharmacyDelivery\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"delivery_type\":{\"description\":\"deliver or collect\",\"type\":\"string\"},\"patient_address\":{\"type\":\"string\"},\"patient_name\":{\"type\":\"string\"},\"patient_postcode\":{\"type\":\"string\"},\"preferred_pharmacy\":{\"type\":\"string\"}},\"required\":[\"patient_name\",\"delivery_type\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Delivery arranged\"}}}},\"/request-prescription\":{\"post\":{\"description\":\"Request repeat prescription from GP surgery\",\"operationId\":\"requestPrescription\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"delivery_preference\":{\"description\":\"deliver or collect\",\"type\":\"string\"},\"medications\":{\"description\":\"Comma-separated medications\",\"type\":\"string\"},\"patient_address\":{\"type\":\"string\"},\"patient_name\":{\"type\":\"string\"},\"pharmacy_name\":{\"type\":\"string\"}},\"required\":[\"patient_name\",\"medications\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Prescription requested\"}}}},\"/validate-referral\":{\"post\":{\"description\":\"Check if patient has valid GP referral for specialist appointment. MUST check before booking specialist/hospital appointments.\",\"operationId\":\"validateReferral\",\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"properties\":{\"nhs_number\":{\"type\":\"string\"},\"patient_name\":{\"type\":\"string\"},\"specialty\":{\"type\":\"string\"}},\"required\":[\"patient_name\"],\"type\":\"object\"}}},\"required\":true},\"responses\":{\"200\":{\"description\":\"Referral validation result\"}}}}}}",
                "s3": []
              }
            ],
            "description": "Actions for scheduling appointments, prescriptions, and pharmacy services",
            "function_schema": [],
            "id": "FDKEJYAI7X,9ESYPRBHBS,DRAFT",
            "parent_action_group_signature": null,
            "prepare_agent": true,
            "region": "us-east-1",
            "skip_resource_in_use_check": false,
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.scheduling",
            "aws_dynamodb_table.bookings",
            "aws_dynamodb_table.prescriptions",
            "aws_dynamodb_table.referrals",
            "aws_dynamodb_table.sessions",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role.lambda",
            "aws_lambda_function.actions",
            "data.archive_file.lambda",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_alias",
      "name": "information_live",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_alias_arn": "arn:aws:bedrock:us-east-1:376337229415:agent-alias/E90JQ9YHKP/0QJHFAMCRV",
            "agent_alias_id": "0QJHFAMCRV",
            "agent_alias_name": "live",
            "agent_id": "E90JQ9YHKP",
            "description": "Live alias for information agent",
            "id": "0QJHFAMCRV,E90JQ9YHKP",
            "region": "us-east-1",
            "routing_configuration": [
              {
                "agent_version": "1",
                "provisioned_throughput": null
              }
            ],
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.information",
            "aws_iam_role.bedrock_agent",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_alias",
      "name": "live",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_alias_arn": "arn:aws:bedrock:us-east-1:376337229415:agent-alias/P7QFL8LKUN/QGFY7425NI",
            "agent_alias_id": "QGFY7425NI",
            "agent_alias_name": "live",
            "agent_id": "P7QFL8LKUN",
            "description": "Live alias",
            "id": "QGFY7425NI,P7QFL8LKUN",
            "region": "us-east-1",
            "routing_configuration": [
              {
                "agent_version": "3",
                "provisioned_throughput": null
              }
            ],
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.supervisor",
            "aws_bedrockagent_agent_action_group.booking",
            "aws_dynamodb_table.bookings",
            "aws_dynamodb_table.prescriptions",
            "aws_dynamodb_table.referrals",
            "aws_dynamodb_table.sessions",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role.lambda",
            "aws_lambda_function.actions",
            "data.archive_file.lambda",
            "data.aws_caller_identity.current",
            "null_resource.prepare_agent"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_alias",
      "name": "scheduling_live",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_alias_arn": "arn:aws:bedrock:us-east-1:376337229415:agent-alias/9ESYPRBHBS/IEFOL2DN6G",
            "agent_alias_id": "IEFOL2DN6G",
            "agent_alias_name": "live",
            "agent_id": "9ESYPRBHBS",
            "description": "Live alias for scheduling agent",
            "id": "IEFOL2DN6G,9ESYPRBHBS",
            "region": "us-east-1",
            "routing_configuration": [
              {
                "agent_version": "3",
                "provisioned_throughput": null
              }
            ],
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.scheduling",
            "aws_iam_role.bedrock_agent",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_alias",
      "name": "supervisor_multi_live",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_alias_arn": "arn:aws:bedrock:us-east-1:376337229415:agent-alias/R5CKKTHOFB/CWU2HM8ITH",
            "agent_alias_id": "CWU2HM8ITH",
            "agent_alias_name": "live",
            "agent_id": "R5CKKTHOFB",
            "description": "Live alias for supervisor",
            "id": "CWU2HM8ITH,R5CKKTHOFB",
            "region": "us-east-1",
            "routing_configuration": [
              {
                "agent_version": "4",
                "provisioned_throughput": null
              }
            ],
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.information",
            "aws_bedrockagent_agent.scheduling",
            "aws_bedrockagent_agent.supervisor_multi",
            "aws_bedrockagent_agent.triage",
            "aws_bedrockagent_agent_alias.information_live",
            "aws_bedrockagent_agent_alias.scheduling_live",
            "aws_bedrockagent_agent_alias.triage_live",
            "aws_bedrockagent_agent_collaborator.information",
            "aws_bedrockagent_agent_collaborator.scheduling",
            "aws_bedrockagent_agent_collaborator.triage",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role_policy.bedrock_agent_collaborator",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_alias",
      "name": "triage_live",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_alias_arn": "arn:aws:bedrock:us-east-1:376337229415:agent-alias/MR73PAVETH/QDLALURO8K",
            "agent_alias_id": "QDLALURO8K",
            "agent_alias_name": "live",
            "agent_id": "MR73PAVETH",
            "description": "Live alias for triage agent",
            "id": "QDLALURO8K,MR73PAVETH",
            "region": "us-east-1",
            "routing_configuration": [
              {
                "agent_version": "1",
                "provisioned_throughput": null
              }
            ],
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.triage",
            "aws_iam_role.bedrock_agent",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_collaborator",
      "name": "information",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_descriptor": [
              {
                "alias_arn": "arn:aws:bedrock:us-east-1:376337229415:agent-alias/E90JQ9YHKP/0QJHFAMCRV"
              }
            ],
            "agent_id": "R5CKKTHOFB",
            "agent_version": "DRAFT",
            "collaboration_instruction": "Route questions about NHS services, appointment types, what to bring, and general NHS information to this agent.",
            "collaborator_id": "NWCMR1IFJF",
            "collaborator_name": "InformationSpecialist",
            "id": "R5CKKTHOFB,DRAFT,NWCMR1IFJF",
            "prepare_agent": true,
            "region": "us-east-1",
            "relay_conversation_history": "TO_COLLABORATOR",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.information",
            "aws_bedrockagent_agent.supervisor_multi",
            "aws_bedrockagent_agent_alias.information_live",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role_policy.bedrock_agent_collaborator",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_collaborator",
      "name": "scheduling",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_descriptor": [
              {
                "alias_arn": "arn:aws:bedrock:us-east-1:376337229415:agent-alias/9ESYPRBHBS/IEFOL2DN6G"
              }
            ],
            "agent_id": "R5CKKTHOFB",
            "agent_version": "DRAFT",
            "collaboration_instruction": "Route booking requests to this agent. Provide the urgency level from triage. It will check availability, offer alternatives, and create bookings.",
            "collaborator_id": "FGJOLHBTR3",
            "collaborator_name": "SchedulingSpecialist",
            "id": "R5CKKTHOFB,DRAFT,FGJOLHBTR3",
            "prepare_agent": true,
            "region": "us-east-1",
            "relay_conversation_history": "TO_COLLABORATOR",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.scheduling",
            "aws_bedrockagent_agent.supervisor_multi",
            "aws_bedrockagent_agent_alias.scheduling_live",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role_policy.bedrock_agent_collaborator",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_collaborator",
      "name": "triage",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_descriptor": [
              {
                "alias_arn": "arn:aws:bedrock:us-east-1:376337229415:agent-alias/MR73PAVETH/QDLALURO8K"
              }
            ],
            "agent_id": "R5CKKTHOFB",
            "agent_version": "DRAFT",
            "collaboration_instruction": "Route patient symptom descriptions and urgency assessments to this agent. It will determine if the case is emergency, urgent, or routine.",
            "collaborator_id": "TJ69VSXQAH",
            "collaborator_name": "TriageSpecialist",
            "id": "R5CKKTHOFB,DRAFT,TJ69VSXQAH",
            "prepare_agent": true,
            "region": "us-east-1",
            "relay_conversation_history": "TO_COLLABORATOR",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.supervisor_multi",
            "aws_bedrockagent_agent.triage",
            "aws_bedrockagent_agent_alias.triage_live",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role_policy.bedrock_agent_collaborator",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_knowledge_base_association",
      "name": "info_kb",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_id": "E90JQ9YHKP",
            "agent_version": "DRAFT",
            "description": "NHS services and appointment information",
            "id": "E90JQ9YHKP,DRAFT,BNGLROUXOJ",
            "knowledge_base_id": "BNGLROUXOJ",
            "knowledge_base_state": "ENABLED",
            "region": "us-east-1",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.information",
            "aws_bedrockagent_knowledge_base.nhs",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role.kb_role",
            "aws_iam_role_policy.kb_policy",
            "aws_s3_bucket.kb_source",
            "aws_s3vectors_index.nhs",
            "aws_s3vectors_vector_bucket.nhs",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_agent_knowledge_base_association",
      "name": "nhs",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "agent_id": "P7QFL8LKUN",
            "agent_version": "DRAFT",
            "description": "NHS services and appointment information",
            "id": "P7QFL8LKUN,DRAFT,BNGLROUXOJ",
            "knowledge_base_id": "BNGLROUXOJ",
            "knowledge_base_state": "ENABLED",
            "region": "us-east-1",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.supervisor",
            "aws_bedrockagent_knowledge_base.nhs",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role.kb_role",
            "aws_iam_role_policy.kb_policy",
            "aws_s3_bucket.kb_source",
            "aws_s3vectors_index.nhs",
            "aws_s3vectors_vector_bucket.nhs",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_data_source",
      "name": "nhs",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "data_deletion_policy": "DELETE",
            "data_source_configuration": [
              {
                "confluence_configuration": [],
                "s3_configuration": [
                  {
                    "bucket_arn": "arn:aws:s3:::nhs-booking-demo-kb-source-376337229415",
                    "bucket_owner_account_id": null,
                    "inclusion_prefixes": null
                  }
                ],
                "salesforce_configuration": [],
                "share_point_configuration": [],
                "type": "S3",
                "web_configuration": []
              }
            ],
            "data_source_id": "5MD90JCUDG",
            "description": null,
            "id": "5MD90JCUDG,BNGLROUXOJ",
            "knowledge_base_id": "BNGLROUXOJ",
            "name": "nhs-booking-demo-datasource",
            "region": "us-east-1",
            "server_side_encryption_configuration": [],
            "timeouts": null,
            "vector_ingestion_configuration": [
              {
                "chunking_configuration": [
                  {
                    "chunking_strategy": "FIXED_SIZE",
                    "fixed_size_chunking_configuration": [
                      {
                        "max_tokens": 300,
                        "overlap_percentage": 20
                      }
                    ],
                    "hierarchical_chunking_configuration": [],
                    "semantic_chunking_configuration": []
                  }
                ],
                "custom_transformation_configuration": [],
                "parsing_configuration": []
              }
            ]
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_knowledge_base.nhs",
            "aws_iam_role.kb_role",
            "aws_iam_role_policy.kb_policy",
            "aws_s3_bucket.kb_source",
            "aws_s3_object.nhs_appointments",
            "aws_s3_object.nhs_patient_flow",
            "aws_s3_object.nhs_services",
            "aws_s3vectors_index.nhs",
            "aws_s3vectors_vector_bucket.nhs",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_flow",
      "name": "booking_flow",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:bedrock:us-east-1:376337229415:flow/6MJTEBZ19S",
            "created_at": "2026-01-05T20:52:48Z",
            "customer_encryption_key_arn": null,
            "definition": [
              {
                "connection": [
                  {
                    "configuration": [
                      {
                        "conditional": [],
                        "data": [
                          {
                            "source_output": "document",
                            "target_input": "agentInputText"
                          }
                        ]
                      }
                    ],
                    "name": "InputToTriage",
                    "source": "FlowInput",
                    "target": "TriageAssessment",
                    "type": "Data"
                  },
                  {
                    "configuration": [
                      {
                        "conditional": [],
                        "data": [
                          {
                            "source_output": "agentResponse",
                            "target_input": "urgencyLevel"
                          }
                        ]
                      }
                    ],
                    "name": "TriageToRouter",
                    "source": "TriageAssessment",
                    "target": "UrgencyRouter",
                    "type": "Data"
                  },
                  {
                    "configuration": [
                      {
                        "conditional": [
                          {
                            "condition": "IsEmergency"
                          }
                        ],
                        "data": []
                      }
                    ],
                    "name": "RouterToEmergency",
                    "source": "UrgencyRouter",
                    "target": "EmergencyOutput",
                    "type": "Conditional"
                  },
                  {
                    "configuration": [
                      {
                        "conditional": [
                          {
                            "condition": "IsUrgent"
                          }
                        ],
                        "data": []
                      }
                    ],
                    "name": "RouterToScheduling",
                    "source": "UrgencyRouter",
                    "target": "ScheduleAppointment",
                    "type": "Conditional"
                  },
                  {
                    "configuration": [
                      {
                        "conditional": [
                          {
                            "condition": "IsRoutine"
                          }
                        ],
                        "data": []
                      }
                    ],
                    "name": "RouterToSchedulingRoutine",
                    "source": "UrgencyRouter",
                    "target": "ScheduleAppointment",
                    "type": "Conditional"
                  },
                  {
                    "configuration": [
                      {
                        "conditional": [],
                        "data": [
                          {
                            "source_output": "agentResponse",
                            "target_input": "document"
                          }
                        ]
                      }
                    ],
                    "name": "SchedulingToOutput",
                    "source": "ScheduleAppointment",
                    "target": "FlowOutput",
                    "type": "Data"
                  }
                ],
                "node": [
                  {
                    "configuration": [
                      {
                        "agent": [],
                        "collector": [],
                        "condition": [],
                        "inline_code": [],
                        "input": [
                          {}
                        ],
                        "iterator": [],
                        "knowledge_base": [],
                        "lambda_function": [],
                        "lex": [],
                        "output": [],
                        "prompt": [],
                        "retrieval": [],
                        "storage": []
                      }
                    ],
                    "input": [],
                    "name": "FlowInput",
                    "output": [
                      {
                        "name": "document",
                        "type": "String"
                      }
                    ],
                    "type": "Input"
                  },
                  {
                    "configuration": [
                      {
                        "agent": [
                          {
                            "agent_alias_arn": "arn:aws:bedrock:us-east-1:376337229415:agent-alias/MR73PAVETH/QDLALURO8K"
                          }
                        ],
                        "collector": [],
                        "condition": [],
                        "inline_code": [],
                        "input": [],
                        "iterator": [],
                        "knowledge_base": [],
                        "lambda_function": [],
                        "lex": [],
                        "output": [],
                        "prompt": [],
                        "retrieval": [],
                        "storage": []
                      }
                    ],
                    "input": [
                      {
                        "category": null,
                        "expression": "$.data",
                        "name": "agentInputText",
                        "type": "String"
                      }
                    ],
                    "name": "TriageAssessment",
                    "output": [
                      {
                        "name": "agentResponse",
                        "type": "String"
                      }
                    ],
                    "type": "Agent"
                  },
                  {
                    "configuration": [
                      {
                        "agent": [],
                        "collector": [],
                        "condition": [
                          {
                            "condition": [
                              {
                                "expression": "emergency",
                                "name": "IsEmergency"
                              },
                              {
                                "expression": "urgent",
                                "name": "IsUrgent"
                              },
                              {
                                "expression": "default",
                                "name": "IsRoutine"
                              }
                            ]
                          }
                        ],
                        "inline_code": [],
                        "input": [],
                        "iterator": [],
                        "knowledge_base": [],
                        "lambda_function": [],
                        "lex": [],
                        "output": [],
                        "prompt": [],
                        "retrieval": [],
                        "storage": []
                      }
                    ],
                    "input": [
                      {
                        "category": null,
                        "expression": "$.data",
                        "name": "urgencyLevel",
                        "type": "String"
                      }
                    ],
                    "name": "UrgencyRouter",
                    "output": [],
                    "type": "Condition"
                  },
                  {
                    "configuration": [
                      {
                        "agent": [],
                        "collector": [],
                        "condition": [],
                        "inline_code": [],
                        "input": [],
                        "iterator": [],
                        "knowledge_base": [],
                        "lambda_function": [],
                        "lex": [],
                        "output": [
                          {}
                        ],
                        "prompt": [],
                        "retrieval": [],
                        "storage": []
                      }
                    ],
                    "input": [
                      {
                        "category": null,
                        "expression": "$.data",
                        "name": "document",
                        "type": "String"
                      }
                    ],
                    "name": "EmergencyOutput",
                    "output": [],
                    "type": "Output"
                  },
                  {
                    "configuration": [
                      {
                        "agent": [
                          {
                            "agent_alias_arn": "arn:aws:bedrock:us-east-1:376337229415:agent-alias/9ESYPRBHBS/IEFOL2DN6G"
                          }
                        ],
                        "collector": [],
                        "condition": [],
                        "inline_code": [],
                        "input": [],
                        "iterator": [],
                        "knowledge_base": [],
                        "lambda_function": [],
                        "lex": [],
                        "output": [],
                        "prompt": [],
                        "retrieval": [],
                        "storage": []
                      }
                    ],
                    "input": [
                      {
                        "category": null,
                        "expression": "$.data",
                        "name": "agentInputText",
                        "type": "String"
                      }
                    ],
                    "name": "ScheduleAppointment",
                    "output": [
                      {
                        "name": "agentResponse",
                        "type": "String"
                      }
                    ],
                    "type": "Agent"
                  },
                  {
                    "configuration": [
                      {
                        "agent": [],
                        "collector": [],
                        "condition": [],
                        "inline_code": [],
                        "input": [],
                        "iterator": [],
                        "knowledge_base": [],
                        "lambda_function": [],
                        "lex": [],
                        "output": [
                          {}
                        ],
                        "prompt": [],
                        "retrieval": [],
                        "storage": []
                      }
                    ],
                    "input": [
                      {
                        "category": null,
                        "expression": "$.data",
                        "name": "document",
                        "type": "String"
                      }
                    ],
                    "name": "FlowOutput",
                    "output": [],
                    "type": "Output"
                  }
                ]
              }
            ],
            "description": "NHS patient booking workflow with triage and scheduling",
            "execution_role_arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-flow-role",
            "id": "6MJTEBZ19S",
            "name": "nhs-booking-demo-booking-flow",
            "region": "us-east-1",
            "status": "NotPrepared",
            "tags": null,
            "tags_all": {},
            "timeouts": null,
            "updated_at": "2026-01-05T20:52:48Z",
            "version": "DRAFT"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.scheduling",
            "aws_bedrockagent_agent.triage",
            "aws_bedrockagent_agent_alias.scheduling_live",
            "aws_bedrockagent_agent_alias.triage_live",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role.flow_role",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_bedrockagent_knowledge_base",
      "name": "nhs",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:bedrock:us-east-1:376337229415:knowledge-base/BNGLROUXOJ",
            "created_at": "2026-01-05T19:44:12Z",
            "description": "NHS appointment and services information",
            "failure_reasons": null,
            "id": "BNGLROUXOJ",
            "knowledge_base_configuration": [
              {
                "kendra_knowledge_base_configuration": [],
                "sql_knowledge_base_configuration": [],
                "type": "VECTOR",
                "vector_knowledge_base_configuration": [
                  {
                    "embedding_model_arn": "arn:aws:bedrock:us-east-1::foundation-model/amazon.titan-embed-text-v2:0",
                    "embedding_model_configuration": [
                      {
                        "bedrock_embedding_model_configuration": [
                          {
                            "dimensions": 1024,
                            "embedding_data_type": "FLOAT32"
                          }
                        ]
                      }
                    ],
                    "supplemental_data_storage_configuration": []
                  }
                ]
              }
            ],
            "name": "nhs-booking-demo-kb",
            "region": "us-east-1",
            "role_arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-kb-role",
            "storage_configuration": [
              {
                "mongo_db_atlas_configuration": [],
                "neptune_analytics_configuration": [],
                "opensearch_managed_cluster_configuration": [],
                "opensearch_serverless_configuration": [],
                "pinecone_configuration": [],
                "rds_configuration": [],
                "redis_enterprise_cloud_configuration": [],
                "s3_vectors_configuration": [
                  {
                    "index_arn": "arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors/index/nhs-booking-demo-index",
                    "index_name": null,
                    "vector_bucket_arn": null
                  }
                ],
                "type": "S3_VECTORS"
              }
            ],
            "tags": null,
            "tags_all": {},
            "timeouts": null,
            "updated_at": "2026-01-05T19:44:12Z"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_iam_role.kb_role",
            "aws_iam_role_policy.kb_policy",
            "aws_s3_bucket.kb_source",
            "aws_s3vectors_index.nhs",
            "aws_s3vectors_vector_bucket.nhs",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_dynamodb_table",
      "name": "bookings",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-bookings",
            "attribute": [
              {
                "name": "booking_id",
                "type": "S"
              }
            ],
            "billing_mode": "PAY_PER_REQUEST",
            "deletion_protection_enabled": false,
            "global_secondary_index": [],
            "global_table_witness": [],
            "hash_key": "booking_id",
            "id": "nhs-booking-demo-bookings",
            "import_table": [],
            "local_secondary_index": [],
            "name": "nhs-booking-demo-bookings",
            "on_demand_throughput": [],
            "point_in_time_recovery": [
              {
                "enabled": false,
                "recovery_period_in_days": 0
              }
            ],
            "range_key": null,
            "read_capacity": 0,
            "region": "us-east-1",
            "replica": [],
            "restore_date_time": null,
            "restore_source_name": null,
            "restore_source_table_arn": null,
            "restore_to_latest_time": null,
            "server_side_encryption": [],
            "stream_arn": "",
            "stream_enabled": false,
            "stream_label": "",
            "stream_view_type": "",
            "table_class": "STANDARD",
            "tags": {},
            "tags_all": {},
            "timeouts": null,
            "ttl": [
              {
                "attribute_name": "",
                "enabled": false
              }
            ],
            "warm_throughput": [],
            "write_capacity": 0
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjYwMDAwMDAwMDAwMCwidXBkYXRlIjozNjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_dynamodb_table",
      "name": "prescriptions",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-prescriptions",
            "attribute": [
              {
                "name": "prescription_id",
                "type": "S"
              }
            ],
            "billing_mode": "PAY_PER_REQUEST",
            "deletion_protection_enabled": false,
            "global_secondary_index": [],
            "global_table_witness": [],
            "hash_key": "prescription_id",
            "id": "nhs-booking-demo-prescriptions",
            "import_table": [],
            "local_secondary_index": [],
            "name": "nhs-booking-demo-prescriptions",
            "on_demand_throughput": [],
            "point_in_time_recovery": [
              {
                "enabled": false,
                "recovery_period_in_days": 0
              }
            ],
            "range_key": null,
            "read_capacity": 0,
            "region": "us-east-1",
            "replica": [],
            "restore_date_time": null,
            "restore_source_name": null,
            "restore_source_table_arn": null,
            "restore_to_latest_time": null,
            "server_side_encryption": [],
            "stream_arn": "",
            "stream_enabled": false,
            "stream_label": "",
            "stream_view_type": "",
            "table_class": "STANDARD",
            "tags": {},
            "tags_all": {},
            "timeouts": null,
            "ttl": [
              {
                "attribute_name": "",
                "enabled": false
              }
            ],
            "warm_throughput": [],
            "write_capacity": 0
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjYwMDAwMDAwMDAwMCwidXBkYXRlIjozNjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_dynamodb_table",
      "name": "referrals",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-referrals",
            "attribute": [
              {
                "name": "referral_id",
                "type": "S"
              }
            ],
            "billing_mode": "PAY_PER_REQUEST",
            "deletion_protection_enabled": false,
            "global_secondary_index": [],
            "global_table_witness": [],
            "hash_key": "referral_id",
            "id": "nhs-booking-demo-referrals",
            "import_table": [],
            "local_secondary_index": [],
            "name": "nhs-booking-demo-referrals",
            "on_demand_throughput": [],
            "point_in_time_recovery": [
              {
                "enabled": false,
                "recovery_period_in_days": 0
              }
            ],
            "range_key": null,
            "read_capacity": 0,
            "region": "us-east-1",
            "replica": [],
            "restore_date_time": null,
            "restore_source_name": null,
            "restore_source_table_arn": null,
            "restore_to_latest_time": null,
            "server_side_encryption": [],
            "stream_arn": "",
            "stream_enabled": false,
            "stream_label": "",
            "stream_view_type": "",
            "table_class": "STANDARD",
            "tags": {},
            "tags_all": {},
            "timeouts": null,
            "ttl": [
              {
                "attribute_name": "expires_at",
                "enabled": true
              }
            ],
            "warm_throughput": [],
            "write_capacity": 0
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjYwMDAwMDAwMDAwMCwidXBkYXRlIjozNjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_dynamodb_table",
      "name": "sessions",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-sessions",
            "attribute": [
              {
                "name": "session_id",
                "type": "S"
              }
            ],
            "billing_mode": "PAY_PER_REQUEST",
            "deletion_protection_enabled": false,
            "global_secondary_index": [],
            "global_table_witness": [],
            "hash_key": "session_id",
            "id": "nhs-booking-demo-sessions",
            "import_table": [],
            "local_secondary_index": [],
            "name": "nhs-booking-demo-sessions",
            "on_demand_throughput": [],
            "point_in_time_recovery": [
              {
                "enabled": false,
                "recovery_period_in_days": 0
              }
            ],
            "range_key": null,
            "read_capacity": 0,
            "region": "us-east-1",
            "replica": [],
            "restore_date_time": null,
            "restore_source_name": null,
            "restore_source_table_arn": null,
            "restore_to_latest_time": null,
            "server_side_encryption": [],
            "stream_arn": "",
            "stream_enabled": false,
            "stream_label": "",
            "stream_view_type": "",
            "table_class": "STANDARD",
            "tags": {},
            "tags_all": {},
            "timeouts": null,
            "ttl": [
              {
                "attribute_name": "ttl",
                "enabled": true
              }
            ],
            "warm_throughput": [],
            "write_capacity": 0
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjYwMDAwMDAwMDAwMCwidXBkYXRlIjozNjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "bedrock_agent",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-bedrock-agent-role",
            "assume_role_policy": "{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Condition\":{\"StringEquals\":{\"aws:SourceAccount\":\"376337229415\"}},\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"bedrock.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}",
            "create_date": "2026-01-05T18:30:21Z",
            "description": "",
            "force_detach_policies": false,
            "id": "nhs-booking-demo-bedrock-agent-role",
            "inline_policy": [
              {
                "name": "nhs-booking-demo-agent-collaborator-policy",
                "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"bedrock:InvokeAgent\",\"bedrock:GetAgentAlias\",\"bedrock:GetAgent\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:bedrock:us-east-1:376337229415:agent/*\",\"arn:aws:bedrock:us-east-1:376337229415:agent-alias/*\"]}]}"
              },
              {
                "name": "nhs-booking-demo-bedrock-agent-policy",
                "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"bedrock:InvokeModel\",\"bedrock:InvokeModelWithResponseStream\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:bedrock:us-east-1::foundation-model/*\",\"arn:aws:bedrock:us-east-1::foundation-model/*\",\"arn:aws:bedrock:us-west-2::foundation-model/*\"]},{\"Action\":[\"bedrock:InvokeModel\",\"bedrock:InvokeModelWithResponseStream\"],\"Effect\":\"Allow\",\"Resource\":\"arn:aws:bedrock:*:376337229415:inference-profile/*\"},{\"Action\":[\"bedrock:InvokeTool\"],\"Effect\":\"Allow\",\"Resource\":\"arn:aws:bedrock:*:*:system-tool/amazon.nova_grounding\"},{\"Action\":[\"lambda:InvokeFunction\"],\"Effect\":\"Allow\",\"Resource\":\"arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions\"}]}"
              }
            ],
            "managed_policy_arns": [],
            "max_session_duration": 3600,
            "name": "nhs-booking-demo-bedrock-agent-role",
            "name_prefix": "",
            "path": "/",
            "permissions_boundary": "",
            "tags": {},
            "tags_all": {},
            "unique_id": "AROAVPH3SMZT6BJNPKLII"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "name": "nhs-booking-demo-bedrock-agent-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "flow_role",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-flow-role",
            "assume_role_policy": "{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Condition\":{\"StringEquals\":{\"aws:SourceAccount\":\"376337229415\"}},\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"bedrock.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}",
            "create_date": "2026-01-05T20:52:39Z",
            "description": "",
            "force_detach_policies": false,
            "id": "nhs-booking-demo-flow-role",
            "inline_policy": [
              {
                "name": "nhs-booking-demo-flow-policy",
                "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"bedrock:InvokeModel\",\"bedrock:InvokeModelWithResponseStream\"],\"Effect\":\"Allow\",\"Resource\":\"arn:aws:bedrock:us-east-1::foundation-model/*\"},{\"Action\":[\"bedrock:InvokeAgent\",\"bedrock:GetAgentAlias\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:bedrock:us-east-1:376337229415:agent/*\",\"arn:aws:bedrock:us-east-1:376337229415:agent-alias/*\"]}]}"
              }
            ],
            "managed_policy_arns": [],
            "max_session_duration": 3600,
            "name": "nhs-booking-demo-flow-role",
            "name_prefix": "",
            "path": "/",
            "permissions_boundary": "",
            "tags": {},
            "tags_all": {},
            "unique_id": "AROAVPH3SMZTT3OZAZNDV"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "name": "nhs-booking-demo-flow-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "kb_role",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-kb-role",
            "assume_role_policy": "{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Condition\":{\"StringEquals\":{\"aws:SourceAccount\":\"376337229415\"}},\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"bedrock.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}",
            "create_date": "2026-01-05T19:29:38Z",
            "description": "",
            "force_detach_policies": false,
            "id": "nhs-booking-demo-kb-role",
            "inline_policy": [
              {
                "name": "nhs-booking-demo-kb-policy",
                "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"s3:GetObject\",\"s3:ListBucket\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:s3:::nhs-booking-demo-kb-source-376337229415\",\"arn:aws:s3:::nhs-booking-demo-kb-source-376337229415/*\"]},{\"Action\":[\"s3vectors:CreateIndex\",\"s3vectors:DeleteIndex\",\"s3vectors:GetIndex\",\"s3vectors:ListIndexes\",\"s3vectors:PutVectors\",\"s3vectors:GetVectors\",\"s3vectors:DeleteVectors\",\"s3vectors:QueryVectors\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors\",\"arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors/*\",\"arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors/index/nhs-booking-demo-index\"]},{\"Action\":[\"bedrock:InvokeModel\"],\"Effect\":\"Allow\",\"Resource\":\"arn:aws:bedrock:us-east-1::foundation-model/*\"}]}"
              }
            ],
            "managed_policy_arns": [],
            "max_session_duration": 3600,
            "name": "nhs-booking-demo-kb-role",
            "name_prefix": "",
            "path": "/",
            "permissions_boundary": "",
            "tags": {},
            "tags_all": {},
            "unique_id": "AROAVPH3SMZT6LUPTIMW6"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "name": "nhs-booking-demo-kb-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "lambda",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::376337229415:role/nhs-booking-demo-lambda-role",
            "assume_role_policy": "{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}",
            "create_date": "2026-01-05T18:30:21Z",
            "description": "",
            "force_detach_policies": false,
            "id": "nhs-booking-demo-lambda-role",
            "inline_policy": [
              {
                "name": "nhs-booking-demo-lambda-dynamodb",
                "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"dynamodb:GetItem\",\"dynamodb:PutItem\",\"dynamodb:UpdateItem\",\"dynamodb:Query\",\"dynamodb:Scan\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-sessions\",\"arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-bookings\",\"arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-prescriptions\",\"arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-referrals\"]}]}"
              },
              {
                "name": "nhs-booking-demo-lambda-location",
                "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"geo:SearchPlaceIndexForText\",\"geo:SearchPlaceIndexForPosition\",\"geo-places:Geocode\",\"geo-places:SearchNearby\",\"geo-places:SearchText\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}]}"
              }
            ],
            "managed_policy_arns": [
              "arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess",
              "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
            ],
            "max_session_duration": 3600,
            "name": "nhs-booking-demo-lambda-role",
            "name_prefix": "",
            "path": "/",
            "permissions_boundary": "",
            "tags": {},
            "tags_all": {},
            "unique_id": "AROAVPH3SMZT6LDRJIFIE"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "name": "nhs-booking-demo-lambda-role"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "bedrock_agent",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "nhs-booking-demo-bedrock-agent-role:nhs-booking-demo-bedrock-agent-policy",
            "name": "nhs-booking-demo-bedrock-agent-policy",
            "name_prefix": "",
            "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"bedrock:InvokeModel\",\"bedrock:InvokeModelWithResponseStream\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:bedrock:us-east-1::foundation-model/*\",\"arn:aws:bedrock:us-east-1::foundation-model/*\",\"arn:aws:bedrock:us-west-2::foundation-model/*\"]},{\"Action\":[\"bedrock:InvokeModel\",\"bedrock:InvokeModelWithResponseStream\"],\"Effect\":\"Allow\",\"Resource\":\"arn:aws:bedrock:*:376337229415:inference-profile/*\"},{\"Action\":[\"bedrock:InvokeTool\"],\"Effect\":\"Allow\",\"Resource\":\"arn:aws:bedrock:*:*:system-tool/amazon.nova_grounding\"},{\"Action\":[\"lambda:InvokeFunction\"],\"Effect\":\"Allow\",\"Resource\":\"arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions\"}]}",
            "role": "nhs-booking-demo-bedrock-agent-role"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "name": "nhs-booking-demo-bedrock-agent-policy",
            "role": "nhs-booking-demo-bedrock-agent-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_dynamodb_table.bookings",
            "aws_dynamodb_table.prescriptions",
            "aws_dynamodb_table.referrals",
            "aws_dynamodb_table.sessions",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role.lambda",
            "aws_lambda_function.actions",
            "data.archive_file.lambda",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "bedrock_agent_collaborator",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "nhs-booking-demo-bedrock-agent-role:nhs-booking-demo-agent-collaborator-policy",
            "name": "nhs-booking-demo-agent-collaborator-policy",
            "name_prefix": "",
            "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"bedrock:InvokeAgent\",\"bedrock:GetAgentAlias\",\"bedrock:GetAgent\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:bedrock:us-east-1:376337229415:agent/*\",\"arn:aws:bedrock:us-east-1:376337229415:agent-alias/*\"]}]}",
            "role": "nhs-booking-demo-bedrock-agent-role"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "name": "nhs-booking-demo-agent-collaborator-policy",
            "role": "nhs-booking-demo-bedrock-agent-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.bedrock_agent",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "flow_policy",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "nhs-booking-demo-flow-role:nhs-booking-demo-flow-policy",
            "name": "nhs-booking-demo-flow-policy",
            "name_prefix": "",
            "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"bedrock:InvokeModel\",\"bedrock:InvokeModelWithResponseStream\"],\"Effect\":\"Allow\",\"Resource\":\"arn:aws:bedrock:us-east-1::foundation-model/*\"},{\"Action\":[\"bedrock:InvokeAgent\",\"bedrock:GetAgentAlias\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:bedrock:us-east-1:376337229415:agent/*\",\"arn:aws:bedrock:us-east-1:376337229415:agent-alias/*\"]}]}",
            "role": "nhs-booking-demo-flow-role"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "name": "nhs-booking-demo-flow-policy",
            "role": "nhs-booking-demo-flow-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.flow_role",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "kb_policy",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "nhs-booking-demo-kb-role:nhs-booking-demo-kb-policy",
            "name": "nhs-booking-demo-kb-policy",
            "name_prefix": "",
            "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"s3:GetObject\",\"s3:ListBucket\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:s3:::nhs-booking-demo-kb-source-376337229415\",\"arn:aws:s3:::nhs-booking-demo-kb-source-376337229415/*\"]},{\"Action\":[\"s3vectors:CreateIndex\",\"s3vectors:DeleteIndex\",\"s3vectors:GetIndex\",\"s3vectors:ListIndexes\",\"s3vectors:PutVectors\",\"s3vectors:GetVectors\",\"s3vectors:DeleteVectors\",\"s3vectors:QueryVectors\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors\",\"arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors/*\",\"arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors/index/nhs-booking-demo-index\"]},{\"Action\":[\"bedrock:InvokeModel\"],\"Effect\":\"Allow\",\"Resource\":\"arn:aws:bedrock:us-east-1::foundation-model/*\"}]}",
            "role": "nhs-booking-demo-kb-role"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "name": "nhs-booking-demo-kb-policy",
            "role": "nhs-booking-demo-kb-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.kb_role",
            "aws_s3_bucket.kb_source",
            "aws_s3vectors_index.nhs",
            "aws_s3vectors_vector_bucket.nhs",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "lambda_dynamodb",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "nhs-booking-demo-lambda-role:nhs-booking-demo-lambda-dynamodb",
            "name": "nhs-booking-demo-lambda-dynamodb",
            "name_prefix": "",
            "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"dynamodb:GetItem\",\"dynamodb:PutItem\",\"dynamodb:UpdateItem\",\"dynamodb:Query\",\"dynamodb:Scan\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-sessions\",\"arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-bookings\",\"arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-prescriptions\",\"arn:aws:dynamodb:us-east-1:376337229415:table/nhs-booking-demo-referrals\"]}]}",
            "role": "nhs-booking-demo-lambda-role"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "name": "nhs-booking-demo-lambda-dynamodb",
            "role": "nhs-booking-demo-lambda-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_dynamodb_table.bookings",
            "aws_dynamodb_table.prescriptions",
            "aws_dynamodb_table.referrals",
            "aws_dynamodb_table.sessions",
            "aws_iam_role.lambda"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "lambda_location",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "nhs-booking-demo-lambda-role:nhs-booking-demo-lambda-location",
            "name": "nhs-booking-demo-lambda-location",
            "name_prefix": "",
            "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"geo:SearchPlaceIndexForText\",\"geo:SearchPlaceIndexForPosition\",\"geo-places:Geocode\",\"geo-places:SearchNearby\",\"geo-places:SearchText\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}]}",
            "role": "nhs-booking-demo-lambda-role"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "name": "nhs-booking-demo-lambda-location",
            "role": "nhs-booking-demo-lambda-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.lambda"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "lambda_basic",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "nhs-booking-demo-lambda-role/arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
            "policy_arn": "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
            "role": "nhs-booking-demo-lambda-role"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "policy_arn": "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
            "role": "nhs-booking-demo-lambda-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.lambda"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "lambda_xray",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "nhs-booking-demo-lambda-role/arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess",
            "policy_arn": "arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess",
            "role": "nhs-booking-demo-lambda-role"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "policy_arn": "arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess",
            "role": "nhs-booking-demo-lambda-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.lambda"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_lambda_alias",
      "name": "actions_live",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions:live",
            "description": "",
            "function_name": "nhs-booking-demo-actions",
            "function_version": "$LATEST",
            "id": "arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions:live",
            "invoke_arn": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions:live/invocations",
            "name": "live",
            "region": "us-east-1",
            "routing_config": []
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "bnVsbA==",
          "dependencies": [
            "aws_dynamodb_table.bookings",
            "aws_dynamodb_table.prescriptions",
            "aws_dynamodb_table.referrals",
            "aws_dynamodb_table.sessions",
            "aws_iam_role.lambda",
            "aws_lambda_function.actions",
            "data.archive_file.lambda"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_lambda_function",
      "name": "actions",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "architectures": [
              "x86_64"
            ],
            "arn": "arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions",
            "capacity_provider_config": [],
            "code_sha256": "Srzbzd2QwXKe/+bc88wjf5X/Mf0+/m8VcRqb2H5XJT8=",
            "code_signing_config_arn": "",
            "dead_letter_config": [],
            "description": "",
            "durable_config": [],
            "environment": [
              {
                "variables": {
                  "BOOKINGS_TABLE": "nhs-booking-demo-bookings",
                  "PRESCRIPTIONS_TABLE": "nhs-booking-demo-prescriptions",
                  "REFERRALS_TABLE": "nhs-booking-demo-referrals",
                  "SESSIONS_TABLE": "nhs-booking-demo-sessions"
                }
              }
            ],
            "ephemeral_storage": [
              {
                "size": 512
              }
            ],
            "file_system_config": [],
            "filename": "./.terraform/lambda.zip",
            "function_name": "nhs-booking-demo-actions",
            "handler": "lambda_actions.handler",
            "id": "nhs-booking-demo-actions",
            "image_config": [],
            "image_uri": "",
            "invoke_arn": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions/invocations",
            "kms_key_arn": "",
            "last_modified": "2026-01-06T00:42:44.000+0000",
            "layers": [],
            "logging_config": [
              {
                "application_log_level": "",
                "log_format": "Text",
                "log_group": "/aws/lambda/nhs-booking-demo-actions",
                "system_log_level": ""
              }
            ],
            "memory_size": 256,
            "package_type": "Zip",
            "publish": false,
            "publish_to": null,
            "qualified_arn": "arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions:$LATEST",
            "qualified_invoke_arn": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/arn:aws:lambda:us-east-1:376337229415:function:nhs-booking-demo-actions:$LATEST/invocations",
            "region": "us-east-1",
            "replace_security_groups_on_destroy": null,
            "replacement_security_group_ids": null,
            "reserved_concurrent_executions": -1,
            "role": "arn:aws:iam::376337229415:role/nhs-booking-demo-lambda-role",
            "runtime": "python3.11",
            "s3_bucket": null,
            "s3_key": null,
            "s3_object_version": null,
            "signing_job_arn": "",
            "signing_profile_version_arn": "",
            "skip_destroy": false,
            "snap_start": [],
            "source_code_hash": "Srzbzd2QwXKe/+bc88wjf5X/Mf0+/m8VcRqb2H5XJT8=",
            "source_code_size": 10912,
            "source_kms_key_arn": "",
            "tags": {},
            "tags_all": {},
            "tenancy_config": [],
            "timeout": 30,
            "timeouts": null,
            "tracing_config": [
              {
                "mode": "Active"
              }
            ],
            "version": "$LATEST",
            "vpc_config": []
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "function_name": "nhs-booking-demo-actions",
            "region": "us-east-1"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_dynamodb_table.bookings",
            "aws_dynamodb_table.prescriptions",
            "aws_dynamodb_table.referrals",
            "aws_dynamodb_table.sessions",
            "aws_iam_role.lambda",
            "data.archive_file.lambda"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_lambda_permission",
      "name": "bedrock",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "action": "lambda:InvokeFunction",
            "event_source_token": null,
            "function_name": "nhs-booking-demo-actions",
            "function_url_auth_type": null,
            "id": "AllowBedrock",
            "principal": "bedrock.amazonaws.com",
            "principal_org_id": null,
            "qualifier": "",
            "region": "us-east-1",
            "source_account": null,
            "source_arn": "arn:aws:bedrock:us-east-1:376337229415:agent/*",
            "statement_id": "AllowBedrock",
            "statement_id_prefix": ""
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "function_name": "nhs-booking-demo-actions",
            "qualifier": null,
            "region": "us-east-1",
            "statement_id": "AllowBedrock"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_dynamodb_table.bookings",
            "aws_dynamodb_table.prescriptions",
            "aws_dynamodb_table.referrals",
            "aws_dynamodb_table.sessions",
            "aws_iam_role.lambda",
            "aws_lambda_function.actions",
            "data.archive_file.lambda",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3_bucket",
      "name": "demo",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acceleration_status": "",
            "acl": null,
            "arn": "arn:aws:s3:::nhs-booking-demo-demo-376337229415",
            "bucket": "nhs-booking-demo-demo-376337229415",
            "bucket_domain_name": "nhs-booking-demo-demo-376337229415.s3.amazonaws.com",
            "bucket_prefix": "",
            "bucket_region": "us-east-1",
            "bucket_regional_domain_name": "nhs-booking-demo-demo-376337229415.s3.us-east-1.amazonaws.com",
            "cors_rule": [],
            "force_destroy": true,
            "grant": [
              {
                "id": "b6952ffb0bf54ead31d3b58cd8be7a56ccf9807862a1d0f01bcc592385dc4b4c",
                "permissions": [
                  "FULL_CONTROL"
                ],
                "type": "CanonicalUser",
                "uri": ""
              }
            ],
            "hosted_zone_id": "Z3AQBSTGFYJSTF",
            "id": "nhs-booking-demo-demo-376337229415",
            "lifecycle_rule": [],
            "logging": [],
            "object_lock_configuration": [],
            "object_lock_enabled": false,
            "policy": "",
            "region": "us-east-1",
            "replication_configuration": [],
            "request_payer": "BucketOwner",
            "server_side_encryption_configuration": [
              {
                "rule": [
                  {
                    "apply_server_side_encryption_by_default": [
                      {
                        "kms_master_key_id": "",
                        "sse_algorithm": "AES256"
                      }
                    ],
                    "bucket_key_enabled": false
                  }
                ]
              }
            ],
            "tags": {},
            "tags_all": {},
            "timeouts": null,
            "versioning": [
              {
                "enabled": false,
                "mfa_delete": false
              }
            ],
            "website": [],
            "website_domain": null,
            "website_endpoint": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "bucket": "nhs-booking-demo-demo-376337229415",
            "region": "us-east-1"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3_bucket",
      "name": "kb_source",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acceleration_status": "",
            "acl": null,
            "arn": "arn:aws:s3:::nhs-booking-demo-kb-source-376337229415",
            "bucket": "nhs-booking-demo-kb-source-376337229415",
            "bucket_domain_name": "nhs-booking-demo-kb-source-376337229415.s3.amazonaws.com",
            "bucket_prefix": "",
            "bucket_region": "us-east-1",
            "bucket_regional_domain_name": "nhs-booking-demo-kb-source-376337229415.s3.us-east-1.amazonaws.com",
            "cors_rule": [],
            "force_destroy": true,
            "grant": [
              {
                "id": "b6952ffb0bf54ead31d3b58cd8be7a56ccf9807862a1d0f01bcc592385dc4b4c",
                "permissions": [
                  "FULL_CONTROL"
                ],
                "type": "CanonicalUser",
                "uri": ""
              }
            ],
            "hosted_zone_id": "Z3AQBSTGFYJSTF",
            "id": "nhs-booking-demo-kb-source-376337229415",
            "lifecycle_rule": [],
            "logging": [],
            "object_lock_configuration": [],
            "object_lock_enabled": false,
            "policy": "",
            "region": "us-east-1",
            "replication_configuration": [],
            "request_payer": "BucketOwner",
            "server_side_encryption_configuration": [
              {
                "rule": [
                  {
                    "apply_server_side_encryption_by_default": [
                      {
                        "kms_master_key_id": "",
                        "sse_algorithm": "AES256"
                      }
                    ],
                    "bucket_key_enabled": false
                  }
                ]
              }
            ],
            "tags": {},
            "tags_all": {},
            "timeouts": null,
            "versioning": [
              {
                "enabled": false,
                "mfa_delete": false
              }
            ],
            "website": [],
            "website_domain": null,
            "website_endpoint": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "bucket": "nhs-booking-demo-kb-source-376337229415",
            "region": "us-east-1"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3_object",
      "name": "nhs_appointments",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acl": null,
            "arn": "arn:aws:s3:::nhs-booking-demo-kb-source-376337229415/nhs_content/appointments.md",
            "bucket": "nhs-booking-demo-kb-source-376337229415",
            "bucket_key_enabled": false,
            "cache_control": "",
            "checksum_algorithm": null,
            "checksum_crc32": "",
            "checksum_crc32c": "",
            "checksum_crc64nvme": "",
            "checksum_sha1": "",
            "checksum_sha256": "",
            "content": "# NHS Appointment Types\r\n\r\n## GP Appointments\r\n- Routine appointments: Usually available within 1-2 weeks\r\n- Urgent appointments: Same day or next day for urgent issues\r\n- Telephone consultations: Quick advice without visiting surgery\r\n\r\n## Specialist Referrals\r\n- Referrals made by your GP\r\n- Waiting times vary by specialty\r\n- Two-week wait for suspected cancer\r\n\r\n## What to Bring\r\n- NHS number if known\r\n- List of current medications\r\n- Any relevant test results\r\n\r\n## Cancellation Policy\r\n- Please cancel at least 24 hours in advance\r\n- Missed appointments waste NHS resources\r\n",
            "content_base64": null,
            "content_disposition": "",
            "content_encoding": "",
            "content_language": "",
            "content_type": "application/octet-stream",
            "etag": "b5f8d24c55da61ae559c2849fd887a1d",
            "force_destroy": false,
            "id": "nhs-booking-demo-kb-source-376337229415/nhs_content/appointments.md",
            "key": "nhs_content/appointments.md",
            "kms_key_id": null,
            "metadata": {},
            "object_lock_legal_hold_status": "",
            "object_lock_mode": "",
            "object_lock_retain_until_date": "",
            "override_provider": [],
            "region": "us-east-1",
            "server_side_encryption": "AES256",
            "source": null,
            "source_hash": null,
            "storage_class": "STANDARD",
            "tags": {},
            "tags_all": {},
            "version_id": "",
            "website_redirect": ""
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "bucket": "nhs-booking-demo-kb-source-376337229415",
            "key": "nhs_content/appointments.md",
            "region": "us-east-1"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_s3_bucket.kb_source",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3_object",
      "name": "nhs_patient_flow",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acl": null,
            "arn": "arn:aws:s3:::nhs-booking-demo-kb-source-376337229415/nhs_content/patient_flow.md",
            "bucket": "nhs-booking-demo-kb-source-376337229415",
            "bucket_key_enabled": false,
            "cache_control": "",
            "checksum_algorithm": null,
            "checksum_crc32": "",
            "checksum_crc32c": "",
            "checksum_crc64nvme": "",
            "checksum_sha1": "",
            "checksum_sha256": "",
            "content": "# Patient Flow and Booking Process\r\n\r\n## Booking an Appointment\r\n1. Contact your GP surgery by phone or online\r\n2. Describe your symptoms to the receptionist\r\n3. You may be offered telephone triage first\r\n4. Appointment booked based on clinical need\r\n\r\n## On the Day\r\n1. Arrive 10 minutes before your appointment\r\n2. Check in at reception or self-service kiosk\r\n3. Wait to be called by your clinician\r\n4. Consultation typically lasts 10-15 minutes\r\n\r\n## After Your Appointment\r\n- Collect any prescriptions from pharmacy\r\n- Book follow-up appointments if needed\r\n- Access your records via NHS App\r\n\r\n## Improving Patient Flow\r\n- Book appropriate appointment type\r\n- Cancel if you can't attend\r\n- Use NHS 111 for advice before booking\r\n",
            "content_base64": null,
            "content_disposition": "",
            "content_encoding": "",
            "content_language": "",
            "content_type": "application/octet-stream",
            "etag": "d2c9349c60ff1c55ddb3605da22c0129",
            "force_destroy": false,
            "id": "nhs-booking-demo-kb-source-376337229415/nhs_content/patient_flow.md",
            "key": "nhs_content/patient_flow.md",
            "kms_key_id": null,
            "metadata": {},
            "object_lock_legal_hold_status": "",
            "object_lock_mode": "",
            "object_lock_retain_until_date": "",
            "override_provider": [],
            "region": "us-east-1",
            "server_side_encryption": "AES256",
            "source": null,
            "source_hash": null,
            "storage_class": "STANDARD",
            "tags": {},
            "tags_all": {},
            "version_id": "",
            "website_redirect": ""
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "bucket": "nhs-booking-demo-kb-source-376337229415",
            "key": "nhs_content/patient_flow.md",
            "region": "us-east-1"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_s3_bucket.kb_source",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3_object",
      "name": "nhs_services",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acl": null,
            "arn": "arn:aws:s3:::nhs-booking-demo-kb-source-376337229415/nhs_content/services.md",
            "bucket": "nhs-booking-demo-kb-source-376337229415",
            "bucket_key_enabled": false,
            "cache_control": "",
            "checksum_algorithm": null,
            "checksum_crc32": "",
            "checksum_crc32c": "",
            "checksum_crc64nvme": "",
            "checksum_sha1": "",
            "checksum_sha256": "",
            "content": "# NHS Services Overview\r\n\r\n## Primary Care\r\n- GP surgeries for general health concerns\r\n- Walk-in centres for minor illnesses\r\n- NHS 111 for urgent medical advice\r\n\r\n## Emergency Services\r\n- A\u0026E for life-threatening emergencies\r\n- Call 999 for immediate danger\r\n- Minor injuries units for non-life-threatening injuries\r\n\r\n## Mental Health\r\n- IAPT services for anxiety and depression\r\n- Crisis teams for urgent mental health support\r\n- Community mental health teams\r\n\r\n## Pharmacy Services\r\n- Minor ailment consultations\r\n- Prescription collection\r\n- Health advice\r\n",
            "content_base64": null,
            "content_disposition": "",
            "content_encoding": "",
            "content_language": "",
            "content_type": "application/octet-stream",
            "etag": "797f8175cbdb4a269b08587674110aed",
            "force_destroy": false,
            "id": "nhs-booking-demo-kb-source-376337229415/nhs_content/services.md",
            "key": "nhs_content/services.md",
            "kms_key_id": null,
            "metadata": {},
            "object_lock_legal_hold_status": "",
            "object_lock_mode": "",
            "object_lock_retain_until_date": "",
            "override_provider": [],
            "region": "us-east-1",
            "server_side_encryption": "AES256",
            "source": null,
            "source_hash": null,
            "storage_class": "STANDARD",
            "tags": {},
            "tags_all": {},
            "version_id": "",
            "website_redirect": ""
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "376337229415",
            "bucket": "nhs-booking-demo-kb-source-376337229415",
            "key": "nhs_content/services.md",
            "region": "us-east-1"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_s3_bucket.kb_source",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3vectors_index",
      "name": "nhs",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "creation_time": "2026-01-05T19:44:00Z",
            "data_type": "float32",
            "dimension": 1024,
            "distance_metric": "cosine",
            "encryption_configuration": [
              {
                "kms_key_arn": null,
                "sse_type": "AES256"
              }
            ],
            "index_arn": "arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors/index/nhs-booking-demo-index",
            "index_name": "nhs-booking-demo-index",
            "metadata_configuration": [],
            "region": "us-east-1",
            "tags": null,
            "tags_all": {},
            "vector_bucket_name": "nhs-booking-demo-vectors"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "index_arn": "arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors/index/nhs-booking-demo-index"
          },
          "dependencies": [
            "aws_s3vectors_vector_bucket.nhs"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3vectors_vector_bucket",
      "name": "nhs",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "creation_time": "2026-01-05T19:44:00Z",
            "encryption_configuration": [
              {
                "kms_key_arn": null,
                "sse_type": "AES256"
              }
            ],
            "force_destroy": true,
            "region": "us-east-1",
            "tags": null,
            "tags_all": {},
            "vector_bucket_arn": "arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors",
            "vector_bucket_name": "nhs-booking-demo-vectors"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "vector_bucket_arn": "arn:aws:s3vectors:us-east-1:376337229415:bucket/nhs-booking-demo-vectors"
          }
        }
      ]
    },
    {
      "mode": "managed",
      "type": "null_resource",
      "name": "prepare_agent",
      "provider": "provider[\"registry.terraform.io/hashicorp/null\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "1619331246888842739",
            "triggers": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.supervisor",
            "aws_bedrockagent_agent_action_group.booking",
            "aws_dynamodb_table.bookings",
            "aws_dynamodb_table.prescriptions",
            "aws_dynamodb_table.referrals",
            "aws_dynamodb_table.sessions",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role.lambda",
            "aws_lambda_function.actions",
            "data.archive_file.lambda",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "null_resource",
      "name": "prepare_supervisor",
      "provider": "provider[\"registry.terraform.io/hashicorp/null\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "2088213472136281094",
            "triggers": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "aws_bedrockagent_agent.information",
            "aws_bedrockagent_agent.scheduling",
            "aws_bedrockagent_agent.supervisor_multi",
            "aws_bedrockagent_agent.triage",
            "aws_bedrockagent_agent_alias.information_live",
            "aws_bedrockagent_agent_alias.scheduling_live",
            "aws_bedrockagent_agent_alias.triage_live",
            "aws_bedrockagent_agent_collaborator.information",
            "aws_bedrockagent_agent_collaborator.scheduling",
            "aws_bedrockagent_agent_collaborator.triage",
            "aws_iam_role.bedrock_agent",
            "aws_iam_role_policy.bedrock_agent_collaborator",
            "data.aws_caller_identity.current"
          ]
        }
      ]
    }
  ],
  "check_results": null
}
